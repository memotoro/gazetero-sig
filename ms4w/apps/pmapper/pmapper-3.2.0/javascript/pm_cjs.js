
/*****************************************************************************
 * Copyright (c) 2003-2006 Armin Burger
 *
 * p.mapper is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version. See the COPYING file.
 *
 * p.mapper is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with p.mapper; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
 ******************************************************************************/

/******************************************************************************
 * geometry.js
 *
 * Copyright (c) 2006 Federico Nieri
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version. See the COPYING file.
 ******************************************************************************/


/*******************************************************************
 sorttable.js
 
 http://www.kryogenix.org/code/browser/sorttable/
 
 Code downloaded from the Browser Experiments section of 
 kryogenix.org is licenced under the so-called MIT licence. 
 The licence is below.

 Copyright (c) 1997-date Stuart Langridge

 Permission is hereby granted, free of charge, to any person 
 obtaining a copy of this software and associated documentation 
 files (the "Software"), to deal in the Software without 
 restriction, including without limitation the rights to use, 
 copy, modify, merge, publish, distribute, sublicense, and/or 
 sell copies of the Software, and to permit persons to whom the 
 Software is furnished to do so, subject to the following conditions:

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, 
 EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES 
 OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND 
 NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT 
 HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, 
 WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, 
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER  
 DEALINGS IN THE SOFTWARE.

********************************************************************/


/* This notice must be untouched at all times.

wz_jsgraphics.js    v. 2.3
The latest version is available at
http://www.walterzorn.com
or http://www.devira.com
or http://www.walterzorn.de

Copyright (c) 2002-2004 Walter Zorn. All rights reserved.
Created 3. 11. 2002 by Walter Zorn (Web: http://www.walterzorn.com )
Last modified: 29. 9. 2004

Performance optimizations for Internet Explorer
by Thomas Frank and John Holdsworth.
fillPolygon method implemented by Matthieu Haller.

High Performance JavaScript Graphics Library.
Provides methods
- to draw lines, rectangles, ellipses, polygons
  with specifiable line thickness,
- to fill rectangles and ellipses
- to draw text.
NOTE: Operations, functions and branching have rather been optimized
to efficiency and speed than to shortness of source code.

LICENSE: LGPL

This library is free software; you can redistribute it and/or
modify it under the terms of the GNU Lesser General Public
License (LGPL) as published by the Free Software Foundation; either
version 2.1 of the License, or (at your option) any later version.

This library is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public
License along with this library; if not, write to the Free Software
Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA,
or see http://www.gnu.org/copyleft/lesser.html 
*/

 Array.prototype.inArray=function(value){var i;for(i=0;i<this.length;i++){if(this[i]===value){return true;}};return false;};function _$(){var elements=new Array();for(var i=0;i<arguments.length;i++){var element=arguments[i];if(typeof element=='string')element=document.getElementById(element);if(arguments.length==1)return element;elements.push(element);};return elements;};function objL(obj){return parseInt(obj.style.left||obj.offsetLeft);};function objT(obj){return parseInt(obj.style.top||obj.offsetTop);};function objW(obj){return parseInt(obj.style.width||obj.clientWidth);};function objH(obj){return parseInt(obj.style.height||obj.clientHeight);};function hideObj(obj){obj.style.visibility='hidden';};function showObj(obj){obj.style.visibility='visible';};function setInnerHTML(elementId,html){var el=_$('toc');el.innerHTML=html;evalInnerJS(el);};function evalInnerJS(element){var scripts=element.getElementsByTagName('script');var code;for(var i=0;i<scripts.length;i++){code=scripts[i].innerHTML?scripts[i].innerHTML : scripts[i].text?scripts[i].text : scripts[i].textContent;try{eval(code);}catch(e){alert(e);}}}
 function openHyperlink(layer,fldName,fldValue){switch(layer){case 'cities10000eu': window.open('http:/'+'/en.wikipedia.org/wiki/'+fldValue,'wikiquery');break;default: alert('See function openHyperlink in custom.js: '+layer+'-'+fldName+'-'+fldValue);}};function showCategoryInfo(cat){alert('Info about category: '+cat);};function showGroupInfo(group){alert('Info about group: '+group);}
 var scale_timeout;function initScaleSelect(){try{writeScaleList(scaleSelectList);}catch(e){return false;}};function writeScaleList(scaleList){var scaleListLen=scaleList.length;var sobj=$('#scale_suggest');if(scaleListLen<1){return false;}else{$('#scaleArea>input').attr("autocomplete","off");};var sobj=$('#scale_suggest');sobj.showv();sobj.html('');var suggest_all='';for(i=0;i<scaleListLen;i++){var sclink=i<1?'scale_link_over':'scale_link';var suggest='<div onmouseover="javascript:scaleOver(this);" ';suggest+='onmouseout="javascript:scaleOut(this);" ';suggest+='onclick="insertScaleTxt(this.innerHTML);" ';suggest+='class="'+sclink+'">'+scaleList[i]+'</div>';suggest_all+=suggest;};sobj.html(suggest_all);};function insertScaleTxt(value){var newScale=value.replace(/,|'|\.|\s/g,'');$('#scaleinput').val(newScale);$('#scale_suggest').html('');hideScaleSuggest();zoom2scale(newScale);};function scaleOver(div_value){div_value.className='scale_link_over';};function scaleOut(div_value){div_value.className='scale_link';};function scaleMouseOut(force){var sobj=_$('scale_suggest');var scaleDivList=sobj.getElementsByTagName('DIV');var hlStyle=false;for(var i=0;i<scaleDivList.length;i++){if(scaleDivList[i].className=='scale_link_over'){hlStyle=true;}};if(force){setTimeout("hideScaleSuggest()",500);}else{clearTimeout(scale_timeout);if(hlStyle){}else{scale_timeout=setTimeout("hideScaleSuggest()",500);}}};function hideScaleSuggest(){$('#scale_suggest').hidev();};function setScaleMO(){scale_mouseover=true;}
 function Point(x,y){this.x=parseFloat(x);this.y=parseFloat(y);};Point.prototype.toString=function(xySeparator){xySeparator=!xySeparator?" " :(""+xySeparator);return(this.x+xySeparator+this.y);};Point.prototype.equals=function(otherPoint){return(this.x==otherPoint.x&&this.y==otherPoint.y);};function Line(firstPoint,secondPoint){this.firstPoint=firstPoint;this.secondPoint=secondPoint;if(secondPoint.x==firstPoint.x){this.a=(secondPoint.y-firstPoint.y)<0?Number.NEGATIVE_INFINITE : Number.POSITIVE_INFINITE;this.b=firstPoint.x;this.vertical=true;}else{this.a=(secondPoint.y-firstPoint.y)/(secondPoint.x-firstPoint.x);this.b=firstPoint.y-this.a*firstPoint.x;this.vertical=false;}};Line.prototype.equals=function(otherLine){return(this.getFirstPoint().equals(otherLine.getFirstPoint())&&this.getSecondPoint().equals(otherLine.getSecondPoint()));};Line.prototype.getLength=function(){return Math.sqrt((Math.pow(this.secondPoint.x-this.firstPoint.x,2))+(Math.pow(this.secondPoint.y-this.firstPoint.y,2)));};Line.prototype.getFirstPoint=function(){return this.firstPoint;};Line.prototype.getSecondPoint=function(){return this.secondPoint;};Line.prototype.isVertical=function(){return this.vertical;};Line.prototype.isParallel=function(otherLine){return(otherLine.isVertical()&&this.isVertical())||(Math.abs(otherLine.a)==Math.abs(this.a));};Line.prototype.intersection=function(otherLine){if(this.isParallel(otherLine))return null;var xInt;var yInt;if(this.isVertical()){xInt=this.getFirstPoint().x;yInt=(otherLine.a*xInt)+otherLine.b;}else if(otherLine.isVertical()){xInt=otherLine.getFirstPoint().x;yInt=(this.a*xInt)+this.b;}else{xInt=(this.b-otherLine.b)/(otherLine.a-this.a);yInt=(this.a*xInt)+this.b;};if(!(xInt>=Math.min(this.getFirstPoint().x,this.getSecondPoint().x)&&xInt<=Math.max(this.getFirstPoint().x,this.getSecondPoint().x)&&xInt>=Math.min(otherLine.getFirstPoint().x,otherLine.getSecondPoint().x)&&xInt<=Math.max(otherLine.getFirstPoint().x,otherLine.getSecondPoint().x)))return null;if(!(yInt>=Math.min(this.getFirstPoint().y,this.getSecondPoint().y)&&yInt<=Math.max(this.getFirstPoint().y,this.getSecondPoint().y)&&yInt>=Math.min(otherLine.getFirstPoint().y,otherLine.getSecondPoint().y)&&yInt<=Math.max(otherLine.getFirstPoint().y,otherLine.getSecondPoint().y)))return null;return new Point(xInt,yInt);};Line.prototype.toString=function(xySeparator,ptSeparator){if(!xySeparator)xySeparator=" ";if(!ptSeparator)ptSeparator=",";return(this.firstPoint.toString()+ptSeparator+this.secondPoint.toString());};function Polygon(points){this.setPoints(points);};Polygon.prototype.getArea=function(){if(!this.isClosed())return 0;var points=this.getPoints();if(points.length<4)return 0;var area=0;for(var k=0;k<(points.length-1);k++){area+=((points[k+1].x-points[k].x)*(points[k+1].y+points[k].y));};area=area/2;return area;};Polygon.prototype.getPerimeter=function(){var nSides=this.getSidesNumber();var perimeter=0;for(var n=1;n<=nSides;n++){perimeter+=this.getSideLength(n);};return perimeter;};Polygon.prototype.getPoints=function(){var tmpPoints=new Array();for(var i=0;i<this.points.length;i++){tmpPoints[i]=this.points[i];};return tmpPoints;};Polygon.prototype.getPoint=function(index){return this.points[index];};Polygon.prototype.setPoints=function(points){if(points&&points instanceof Array){this.points=points;}else{this.points=new Array();}};Polygon.prototype.addPoint=function(point){this.points.push(point);};Polygon.prototype.getPointsNumber=function(){return this.points.length;};Polygon.prototype.getSidesNumber=function(){if(this.points.length==0)return 0;return this.points.length-1;};Polygon.prototype.getXList=function(){var xList=new Array();for(var i=0;i<this.points.length;i++){xList[i]=this.points[i].x;};return xList;};Polygon.prototype.getYList=function(){var yList=new Array();for(var i=0;i<this.points.length;i++){yList[i]=this.points[i].y;};return yList;};Polygon.prototype.delPoint=function(index){this.points.splice(index,1);};Polygon.prototype.close=function(){if(!this.isClosed()){this.addPoint(this.getPoint(0));}};Polygon.prototype.isClosed=function(){var points=this.getPoints();return(points.length>2&&points[0].equals(points[points.length-1]));};Polygon.prototype.getSideLength=function(sideNumber){return Math.sqrt((Math.pow(this.points[sideNumber].x-this.points[sideNumber-1].x,2))+(Math.pow(this.points[sideNumber].y-this.points[sideNumber-1].y,2)));};Polygon.prototype.getSide=function(sideNumber){if(sideNumber==0)return null;if(sideNumber>this.getSidesNumber())return null;return new Line(this.getPoint(sideNumber-1),this.getPoint(sideNumber));};Polygon.prototype.getLastSide=function(){return this.getSide(this.getSidesNumber());};Polygon.prototype.getFirstSide=function(){return this.getSide(1);};Polygon.prototype.reset=function(){this.points.length=0;};Polygon.prototype.toString=function(xySeparator,ptSeparator){if(!xySeparator)xySeparator=" ";if(!ptSeparator)ptSeparator=",";var pointsString="";var points=this.getPoints();for(var i=0;i<points.length;i++){pointsString+=points[i].toString(xySeparator);if(i<(points.length-1)){pointsString+=ptSeparator;}};return pointsString;}
 function pmLayout_init(){Layout.update();tocResizeUpdate();};function PM_Layout2(){};PM_Layout.prototype.update=function(){var winix=0,winiy=0;if(typeof(window.innerWidth)=='number'){winix=window.innerWidth;winiy=window.innerHeight;}else if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)){winix=parseInt(document.documentElement.clientWidth);winiy=parseInt(document.documentElement.clientHeight);}else if(document.body&&(document.body.clientWidth||document.body.clientHeight)){winix=document.body.clientWidth;winiy=document.body.clientHeight;};if(_$('pm_master')){var pm_master=$('#pm_master');if(this.MasterResize){var masterW=winix-(this.MasterLeft+this.MasterMarginE);var masterH=winiy-(this.MasterTop+this.MasterMarginS);}else{var masterW=this.MasterWidth;var masterH=this.MasterHeight;};this.setParams(pm_master,this.MasterLeft,this.MasterTop,masterW,masterH);}else{var masterW=winix;var masterH=winiy;};var north=$('#north');var south=$('#south');var west=$('#west');var east=$('#east');var mapZone=$('#mapZone');var map=$('#map');var mapNorth=$('#mapNorth');var mapSouth=$('#mapSouth');var mapWest=$('#mapWest');var mapEast=$('#mapEast');var mapimgLayer=$('#mapimgLayer');var mapImg=$('#mapImg');var loading=$('#loading');var refZone=$('#refZone');var infoZone=$('#infoZone');var innerElemH=masterH-(this.NorthHeight+this.SouthHeight+this.MarginOuterHorizN+this.MarginOuterHorizS);var innerElemT=this.NorthHeight+this.MarginOuterHorizN;var InfoZoneTotH=this.InfoZoneHeight>0?this.InfoZoneHeight+this.MarginInnerHoriz : 0;var mapZoneH=innerElemH-InfoZoneTotH;var mapZoneW=masterW-(this.MarginOuterVertW+this.MarginOuterVertE+this.MarginInnerVertW+this.MarginInnerVertE+this.WestWidth+this.EastWidth);var mapZoneL=this.MarginOuterVertW+this.WestWidth+this.MarginInnerVertW;var mapT=innerElemT+this.MapNorthHeight;mapW=mapZoneW-(this.MapWestWidth+this.MapEastWidth);mapH=mapZoneH-(this.MapNorthHeight+this.MapSouthHeight);var mapWestEastH=this.MapWestEastFull?mapZoneH : mapH;var mapWestEastT=this.MapWestEastFull?0 : this.MapNorthHeight;var mapNorthSouthW=this.MapWestEastFull?mapW : mapZoneW;var mapNorthSouthL=this.MapWestEastFull?this.MapWestWidth : 0;var westH=(this.InfoZoneStyle==1?innerElemH : mapZoneH)-(this.RefZoneHorizPos=='w'?this.RefZoneHeight+this.MarginInnerHoriz : 0);var eastH=(this.InfoZoneStyle==2?innerElemH : mapZoneH)-(this.RefZoneHorizPos=='e'?this.RefZoneHeight+this.MarginInnerHoriz : 0);;var westT=(this.RefZoneHorizPos=='w'?(this.RefZoneVertPos=='n'?innerElemT+this.RefZoneHeight+this.MarginInnerHoriz : innerElemT): innerElemT);var eastT=(this.RefZoneHorizPos=='e'?(this.RefZoneVertPos=='n'?innerElemT+this.RefZoneHeight+this.MarginInnerHoriz : innerElemT): innerElemT);var refZoneL=(this.RefZoneHorizPos=='w'?this.MarginOuterVertW : mapZoneL+mapZoneW+this.MarginInnerVertE);var refZoneT=(this.RefZoneVertPos=='n'?innerElemT :(this.RefZoneHorizPos=='w'?westT+westH+this.MarginInnerHoriz : eastT+eastH+this.MarginInnerHoriz));var refZoneW=(this.RefZoneHorizPos=='w'?this.WestWidth : this.EastWidth);if(this.InfoZoneStyle==1){var infoZoneL=mapZoneL;var infoZoneW=mapZoneW+this.MarginInnerVertE+this.EastWidth;}else if(this.InfoZoneStyle==2){var infoZoneL=this.MarginOuterVertW;var infoZoneW=this.WestWidth+this.MarginInnerVertW+mapZoneW;}else{var infoZoneL=this.MarginOuterVertW;var infoZoneW=masterW-(this.MarginOuterVertW+this.MarginOuterVertE);};this.setParams(north,0,0,masterW,this.NorthHeight);south.left(0+'px');south.css('bottom',0+'px');south.width(masterW+'px');south.height(this.SouthHeight+'px');this.setParams(west,this.MarginOuterVertW,westT,this.WestWidth,westH);this.setParams(east,mapZoneL+mapZoneW+this.MarginInnerVertE,eastT,this.EastWidth,eastH);this.setParams(mapZone,mapZoneL,innerElemT,mapZoneW,mapZoneH);this.setParams(map,this.MapWestWidth,this.MapNorthHeight,mapW,mapH);this.setParams(mapWest,0,mapWestEastT,this.MapWestWidth,mapWestEastH);this.setParams(mapEast,this.MapWestWidth+mapW,mapWestEastT,this.MapEastWidth,mapWestEastH);this.setParams(mapNorth,mapNorthSouthL,0,mapNorthSouthW,this.MapNorthHeight);this.setParams(mapSouth,mapNorthSouthL,this.MapNorthHeight+mapH,mapNorthSouthW,this.MapSouthHeight);this.setParams(refZone,refZoneL,refZoneT,refZoneW,this.RefZoneHeight);this.setParams(infoZone,infoZoneL,mapZoneH+this.NorthHeight+this.MarginOuterHorizN+this.MarginInnerHoriz,infoZoneW,this.InfoZoneHeight);this.setParams(mapimgLayer,0,0,mapW,mapH);this.setParams(mapImg,0,0,mapW,mapH);var loadimg=_$('loadingimg');this.setParams(loading,(mapW/2-objW(loadimg)/2),(mapH/2-objH(loadimg)/2),objW(loadimg),objH(loadimg));updateSlider_s1(mapW,mapH);var mapurl=PM_XAJAX_LOCATION+'x_load.php?'+SID+'&mapW='+mapW+'&mapH='+mapH+'&zoom_type=zoompoint';if(navigator.appName.indexOf("Microsoft")!=-1){clearTimeout(PMap.resize_timer);PMap.resize_timer=setTimeout("updateMap('"+mapurl+"','')",500);}else{updateMap(mapurl,'');}};PM_Layout.prototype.setParams=function(obj,L,T,W,H){if(obj){obj.left(L+'px');obj.top(T+'px');obj.width(W+'px');obj.height(H+'px');if(W<1||H<1)obj.hidev();}}
 var useCustomCursor=true;var jitter=10;function zoombox_apply(minx,miny,maxx,maxy){var imgbox=minx+"+"+miny+"+"+maxx+"+"+maxy;var imgxy=minx+"+"+miny;if(refmapClick==false){var varform=_$("varform");var vmode=varform.mode.value;if(vmode=='map'||rightMouseButton){showloading();if((minx+jitter)>maxx&&(miny+jitter)>maxy){if(varform.zoom_type.value=='zoomrect'){if(rightMouseButton){zoom_factor=1;}else{zoom_factor=2;};zoompoint(zoom_factor,imgxy);}else{var zoom_factor=varform.zoom_factor.value;zoompoint(zoom_factor,imgxy);}}else{zoomin(imgbox);}}else if(vmode=='query'){showqueryresult('query',imgxy);}else if(vmode=='nquery'){var selform=_$("selform");if(!selform.selgroup)return false;if(selform.selgroup.selectedIndex !=-1){if((minx+jitter)>maxx&&(miny+jitter)>maxy){showqueryresult('nquery',imgxy);}else{showqueryresult('nquery',imgbox);}}}else if(vmode=='poi'){openPoiDlg(imgxy);}else{try{eval(vmode+'_start(imgbox)');return false;}catch(e){}}}else{zoomref(imgxy);}};function zoompoint(zoomfactor,imgxy){var mapurl=PM_XAJAX_LOCATION+'x_load.php?'+SID+'&mode=map&zoom_type=zoompoint&zoom_factor='+zoomfactor+'&imgxy='+imgxy;showloading();updateMap(mapurl);};function zoomin(extent){var mapurl=PM_XAJAX_LOCATION+'x_load.php?'+SID+'&mode=map&zoom_type=zoomrect&imgbox='+extent;updateMap(mapurl);};function zoom2extent(layer,idx,geoextent){showloading();if(layer==0&&idx==0){var layerstring='';}else{var layerstring='&resultlayer='+layer+'+'+idx;};var mapurl=PM_XAJAX_LOCATION+'x_load.php?'+SID+'&mode=map&zoom_type=zoomextent&extent='+geoextent+layerstring;updateMap(mapurl);};function zoomfullext(){showloading();var mapurl=PM_XAJAX_LOCATION+'x_load.php?'+SID+'&mode=map&zoom_type=zoomfull';updateMap(mapurl);};function goback(){showloading();var mapurl=PM_XAJAX_LOCATION+'x_load.php?'+SID+'&mode=map&zoom_type=zoomback';updateMap(mapurl);};function gofwd(){showloading();var mapurl=PM_XAJAX_LOCATION+'x_load.php?'+SID+'&mode=map&zoom_type=zoomfwd';updateMap(mapurl);};function zoom2group(gid){showloading();var groupname=gid.substr(5);var mapurl=PM_XAJAX_LOCATION+'x_load.php?'+SID+'&mode=map&zoom_type=zoomgroup&groupname='+groupname;updateMap(mapurl);};function zoom2selected(){if(typeof(PMap.extentSelectedFeatures)!='undefined'){if(PMap.extentSelectedFeatures){showloading();var mapurl=PM_XAJAX_LOCATION+'x_load.php?'+SID+'&mode=map&zoom_type=zoomextent&extent='+PMap.extentSelectedFeatures;updateMap(mapurl);}}};function changeLayersDraw(){showloading();var mapurl=PM_XAJAX_LOCATION+'x_load.php?'+SID+'&zoom_type=zoompoint';updateMap(mapurl);};function clickStopLoading(){stoploading();if(document.all){document.execCommand('Stop')}else{window.stop();}};function arrowpan(direction){showloading();var pansize=0.1;var px,py;if(direction=='n'){px=(mapW-1)/2;py=(0+pansize)*mapH;}else if(direction=='s'){px=(mapW-1)/2;py=(1-pansize)*mapH;}else if(direction=='e'){px=(1-pansize)*mapW;py=(mapH-1)/2;}else if(direction=='w'){px=(0+pansize)*mapW;py=(mapH-1)/2;};zoompoint(1,px+"+"+py);};function zoomref(imgxy){showloading();var mapurl=PM_XAJAX_LOCATION+'x_load.php?'+SID+'&mode=map&zoom_type=ref&imgxy='+imgxy;updateMap(mapurl);};function setRefImg(refimgsrc){var refimg=parent.refFrame.document.getElementById('refimg');refimg.src=refimgsrc;};function zoom2scale(scale){showloading();var mapurl=PM_XAJAX_LOCATION+'x_load.php?'+SID+'&mode=map&zoom_type=zoomscale&scale='+scale;updateMap(mapurl);};function writescale(scale){if(_$("scaleform"))_$("scaleform").scale.value=scale;};function domouseclick(button){var varform=_$("varform");resetFrames();switch(button){case 'zoomin': varform.mode.value='map';varform.zoom_type.value='zoomrect';varform.maction.value='box';varform.tool.value='zoomin';break;case 'zoomout': varform.mode.value='map';varform.zoom_type.value='zoompoint';varform.zoom_factor.value='-2';varform.maction.value='click';varform.tool.value='zoomout';break;case 'identify': varform.mode.value='query';varform.maction.value='click';varform.tool.value='identify';break;case 'pan': varform.mode.value='map';varform.zoom_type.value='zoompoint';varform.zoom_factor.value='1';varform.maction.value='pan';varform.tool.value='pan';break;case 'select': varform.mode.value='nquery';varform.maction.value='box';var selurl=PM_XAJAX_LOCATION+'x_select.php?'+SID;updateSelectTool(selurl,'');varform.tool.value='select';break;case 'auto_identify': varform.mode.value='iquery';varform.maction.value='move';varform.tool.value='auto_identify';var selurl=PM_XAJAX_LOCATION+'x_select.php?'+SID+'&autoidentify=1';updateSelectTool(selurl,'');break;case 'measure': varform.maction.value='measure';varform.mode.value='measure';varform.tool.value='measure';createMeasureInput();break;case 'digitize': varform.mode.value='digitize';varform.maction.value='click';varform.tool.value='digitize';break;case 'poi': varform.mode.value='poi';varform.maction.value='click';varform.tool.value='poi';break;default: try{eval(button+'_click()');return false;}catch(e){}};if(useCustomCursor){setCursor(false,false);}};function poi_mclick(){var varform=_$("varform");varform.mode.value='poi';varform.maction.value='click';varform.tool.value='poi';if(useCustomCursor){setCursor(false,'crosshair');}};function resetFrames(){hideHelpMessage();var varform=_$("varform");if(varform.mode.value=='nquery'||varform.mode.value=='iquery'||varform.maction.value=='measure'){if(varform.maction.value=='measure'){resetMeasure();};if(varform.mode.value=='iquery'||varform.mode.value=='nquery')hideObj(_$('iqueryLayer'));}else{$('#mapToolArea').html('');}};function createMeasureInput(){var mStr='<form name="measureForm"><table class="TOOLFRAME"><tr><td NOWRAP>'+localeList['Total']+pmMeasureUnits.distance+'</td><td><input type=text size=9 name="sumLen"></td>';mStr+='<td id="mSegTxt" value="&nbsp;&nbsp;'+localeList['Segment']+'" NOWRAP>&nbsp;&nbsp;'+localeList['Segment']+pmMeasureUnits.distance+'</td><td><input type=text size=9 name="segLen"></td>';mStr+='<td width=130 class="TDAR"><input type="button" id="cbut_measure" value="'+localeList['Clear'];mStr+='" class="button_off" name="custombutton" onClick="javascript:clearMeasure()">';mStr+='</td></tr></table></form>';$('#mapToolArea').html(mStr);pmCButton_init('cbut_measure');showHelpMessage(localeList['digitize_help']);};function reloadMap(remove){showloading();var mapurl=PM_XAJAX_LOCATION+'x_load.php?'+SID+'&zoom_type=zoompoint';if(remove){mapurl+='&resultlayer=remove';PMap.extentSelectedFeatures=null;};updateMap(mapurl);};function showHelpMessage(hm){$('#helpMessage').html(hm).showv();};function hideHelpMessage(){$('#helpMessage').html('').hidev();};function clearInfo(){var varform=_$("varform");varform.zoomselected.value='0';reloadMap(true);};function showloading(){$("#loading").showv();};function stoploading(){$('#loading').hidev();};function pmIndicator_show(x,y){if(x){$('#pmIndicatorContainer').css({top: parseInt(y)+offsY-35+'px',left: parseInt(x)+offsX-15+'px'}).show();}else{$('#pmIndicatorContainer').css({top:'5px',right:'5px'}).show();}};function pmIndicator_hide(){$('#pmIndicatorContainer').hide();};function setSlider(curscale){if(myslider){var sliderPos=getSliderPosition(curscale);myslider.setPosition(sliderPos);if(_$('refsliderbox'))hideObj(_$('refsliderbox'));};return false;}
 function _p(str){return localeList[str];};function loadMapImg(mapImgSrc){var theMapImg=_$("mapImg");theMapImg.src=mapImgSrc;};function resetMapImgParams(){var theMapImgL=_$("mapimgLayer");var theMapImg=_$("mapImg");theMapImg.style.width=mapW+"px";theMapImg.style.height=mapH+"px";theMapImgL.style.top=0+"px";theMapImgL.style.left=0+"px";theMapImgL.style.width=mapW+"px";theMapImgL.style.height=mapH+"px";theMapImgL.style.clip='rect(auto auto auto auto)';$('#zoombox').hidev();$('#loading').hidev();maploading=false;var varformMode=_$("varform").mode.value;if(varformMode=='measure'){resetMeasure();polyline=toPxPolygon(geoPolyline);if(polyline.getPointsNumber()>0){drawPolyline(jg,polyline);}}};function updateSlider_s1(pixW,pixH){var maxScale1=((PMap.dgeo_x*PMap.dgeo_c)/pixW)/(0.0254/96);var maxScale2=((PMap.dgeo_y*PMap.dgeo_c)/pixH)/(0.0254/96);PMap.s1=Math.max(maxScale1,maxScale2);};function setTbTDButton(button){if(PMap.tbImgSwap !=1){$("#mapZone .TOOLBARTD").addClass('TOOLBARTD_OFF').removeClass('TOOLBARTD_ON');$('#tb_'+button).removeClass('TOOLBARTD_OFF').addClass('TOOLBARTD_ON').removeClass('TOOLBARTD_OVER');}else{$("#mapZone .TOOLBARTD").each(function(){$(this).find('>img').imgSwap('_on','_off');});$('#tb_'+button).find('>img').imgSwap('_off','_on').imgSwap('_over','_on');}};function TbDownUp(elId,status){var but=$('#tb_'+elId);if(status=='d'){if(PMap.tbImgSwap !=1){but.addClass('TOOLBARTD_ON').removeClass('TOOLBARTD_OFF').removeClass('TOOLBARTD_OVER');}else{but.find('>img').imgSwap('_off','_on').imgSwap('_over','_on');}}else{if(PMap.tbImgSwap !=1){but.addClass('TOOLBARTD_OFF').removeClass('TOOLBARTD_ON').addClass('TOOLBARTD_OVER');}else{if(PMap.tbImgSwap==1)but.find('>img').imgSwap('_on','_off');}}};function changeButtonClr(myObj,myAction){switch(myAction){case 'over': myObj.className='button_on';break;case 'out': myObj.className='button_off';break;}};function getRootPath(){var theLoc=document.location.href;var theLastPos=theLoc.lastIndexOf('/');var RootPath=theLoc.substr(0,theLastPos)+'/';return RootPath;};function setCursor(rmc,ctype){if(!rmc){var varform=_$("varform");if(varform){var toolType=varform.tool.value;}else{var toolType='zoomin';}}else{toolType='pan';};try{var iC=pmUseInternalCursors;}catch(e){var iC=true;};var rootPath=getRootPath();var usedCursor=(iC)?toolType : 'url("'+rootPath+'images/cursors/zoomin.cur"),default';_$('mapimgLayer').style.cursor=usedCursor;switch(toolType){case "zoomin" : var usedCursor=(iC)?'crosshair' : 'url("'+rootPath+'images/cursors/zoomin.cur"),default';break;case "zoomout" : var usedCursor=(iC)?'e-resize' : 'url('+rootPath+'images/cursors/zoomout.cur),default';break;case "identify" : var usedCursor='help';break;case "auto_identify" : var usedCursor='pointer';break;case "pan" : var usedCursor='move';break;case "select" : var usedCursor=(iC)?'help' : 'help';break;case "measure" : var usedCursor=(iC)?'crosshair' : 'url('+rootPath+'images/cursors/measure.cur),default';break;case "digitize" : var usedCursor='crosshair';break;default: var usedCursor='default';};if(ctype)usedCursor=ctype;_$('mapimgLayer').style.cursor=usedCursor;};function openResultwin(winurl){try{if(queryResultLayout=='tree'){var winw=300;var winh=450;}else{var winw=500;var winh=200;}}catch(e){var winw=500;var winh=200;};var w=window.open(winurl,'resultwin','width='+winw+',height='+winh+',status=yes,resizable=yes,scrollbars=yes');w.focus();return w;};function openHelp(){createDnRDlg({w:500,h:300,l:100,t:50},{resizeable:true,newsize:true},'pmDlgContainer',localeList['Help'],'Gazetero/help/help.phtml?'+SID);};function openDownloadDlg(){createDnRDlg({w:260,h:220,l:200,t:200},{resizeable:false,newsize:true},'pmDlgContainer',localeList['Download'],'downloaddlg.phtml?'+SID);};function openDownload(){window.open("download.phtml?"+SID,"download");};function openPoiDlg(imgxy){var coordsList=imgxy.split('+');var mpoint=getGeoCoords(coordsList[0],coordsList[1],false);var rfactor=5;var px=isNaN(mpoint.x)?'' : roundN(mpoint.x,rfactor);var py=isNaN(mpoint.y)?'' : roundN(mpoint.y,rfactor);var inserttxt=prompt(localeList['addLocation'],'');if(inserttxt){var digitizeurl=PM_XAJAX_LOCATION+'x_poi.php?'+SID+'&up='+px+'@@'+py+'@@'+inserttxt;addPOI(digitizeurl);}};function openPrintDlg(){createDnRDlg({w:350,h:280,l:200,t:200},{resizeable:true,newsize:true},'pmDlgContainer',localeList['Print_Settings'],'printdlg.phtml?'+SID);};function printDlgShowAdvanced(){$('div.printdlg_advanced').show();$('#printdlg_button_advanced').hide();$('#printdlg_button_normal').show();$('#pmDlgContainer').height(parseInt($('#printdlg').innerHeight())+60);adaptDWin($('#pmDlgContainer'));};function printDlgHideAdvanced(){$('div.printdlg_advanced').hide();$('#printdlg_button_normal').hide();$('#printdlg_button_advanced').show();$('#pmDlgContainer').height(parseInt($('#printdlg').innerHeight())+60);adaptDWin($('#pmDlgContainer'));}
 if(typeof(pmMeasureUnits)=="undefined")pmMeasureUnits={distance:" [km]",area:" [km&sup2;]",factor:1000};if(typeof(pmMeasureObjects)=="undefined")pmMeasureObjects={line:{color:'#FF0000',width:2}};var numSize;var polyline=new Polygon();var geoPolyline=new Polygon();polyline.lineWidth=pmMeasureObjects.line.width;polyline.lineColor=pmMeasureObjects.line.color;function toGeoPoint(pxPoint){var x_geo=minx_geo+((pxPoint.x/mapW)*xdelta_geo);var y_geo=maxy_geo-((pxPoint.y/mapH)*ydelta_geo);return new Point(x_geo,y_geo);};function toGeoPolygon(pxPolygon){var pxPoints=pxPolygon.getPoints();var geoPolygon=new Polygon();for(var i=0;i<pxPoints.length;i++){geoPolygon.addPoint(toGeoPoint(pxPoints[i]));};return geoPolygon;};function toPxPolygon(geoPolygon){var geoPoints=geoPolygon.getPoints();var pxPolygon=new Polygon();for(var i=0;i<geoPoints.length;i++){pxPolygon.addPoint(toPxPoint(geoPoints[i]));};return pxPolygon;};function toPxPoint(geoPoint){var x_px=((geoPoint.x-minx_geo)/xdelta_geo)*mapW;var y_px=((maxy_geo-geoPoint.y)/ydelta_geo)*mapH;return new Point(x_px,y_px);};function toGeoLength(pxLength){return(pxLength/mapW)*xdelta_geo;};function measureDrawSymbols(e,clickX,clickY,dblClick){if(polyline.isClosed()){polyline.reset();};var nPoints=polyline.getPointsNumber();var clickPoint=new Point(clickX,clickY);if(nPoints==0)resetMeasure();if((clickX<mapW)&&(clickY<mapH)){if(dblClick !=1){polyline.addPoint(new Point(clickX,clickY));if(nPoints<1){drawLineSegment(jg,new Line(clickPoint,clickPoint));}else{var lastSegment=polyline.getLastSide();var sidesNumber=polyline.getSidesNumber();if(sidesNumber>2){for(var s=1;s<(sidesNumber-1);s++){var intersectionPoint=polyline.getSide(s).intersection(lastSegment);if(intersectionPoint !=null){alert(localeList['digitize_over']);polyline.delPoint(polyline.getPointsNumber()-1);return;}}};drawLineSegment(jg,lastSegment);onDigitizedSide(polyline);}}else if(dblClick){polyline.delPoint(polyline.getPointsNumber()-1);polyline.close();var lastSegment=polyline.getLastSide();var sidesNumber=polyline.getSidesNumber();for(var s=2;s<(sidesNumber-1);s++){var intersectionPoint=polyline.getSide(s).intersection(lastSegment);if(intersectionPoint !=null){alert(localeList['digitize_over']);polyline.delPoint(polyline.getPointsNumber()-1);return false;}};if(lastSegment !=null){drawLineSegment(jg,lastSegment);};onDigitizedPolygon(polyline);}};geoPolyline=toGeoPolygon(polyline);};function onDigitizedPolygon(poly){var polyGEO=toGeoPolygon(poly);var perimGEO=polyGEO.getPerimeter()/pmMeasureUnits.factor;var cntPerLen=Math.round(perimGEO).toString().length;numSize=Math.max(0,(4-cntPerLen));perimGEO=roundN(perimGEO,numSize);var areaGEO=Math.abs(roundN(polyGEO.getArea()/(pmMeasureUnits.factor*pmMeasureUnits.factor),numSize-1));document.measureForm.sumLen.value=perimGEO;$("#mSegTxt").html(localeList['Area']+pmMeasureUnits.area);document.measureForm.segLen.value=areaGEO;};function onDigitizedSide(poly){var polyGEO=toGeoPolygon(poly);var segLenGEO_0=polyGEO.getSideLength(polyGEO.getSidesNumber())/pmMeasureUnits.factor;var perimGEO_0=polyGEO.getPerimeter()/pmMeasureUnits.factor;var cntSegLen=Math.round(segLenGEO_0).toString().length;numSize=Math.max(0,(4-cntSegLen));var segLenGEO=roundN(segLenGEO_0,numSize);var perimGEO=roundN(perimGEO_0,numSize);var measureSegment=false;if(measureSegment){document.measureForm.segLen.value=segLenGEO;if(polyGEO.getPointsNumber()>=2){poly.reset();}}else{document.measureForm.sumLen.value=perimGEO;document.measureForm.segLen.value=segLenGEO;}};function redrawAll(currX,currY){if(polyline.isClosed())return;if(polyline.getPointsNumber()>0){var mousePoint=new Point(currX,currY);jg_tmp.clear();jg_tmp.setColor(pmMeasureObjects.line.color);jg_tmp.setStroke(pmMeasureObjects.line.width);var lastPoint=polyline.getPoint(polyline.getPointsNumber()-1);drawLineSegment(jg_tmp,new Line(lastPoint,mousePoint));jg_tmp.setStroke(Stroke.DOTTED);var firstPoint=polyline.getPoint(0);drawLineSegment(jg_tmp,new Line(firstPoint,mousePoint));}};function drawPolyline(jg,poly){var n=poly.getSidesNumber();for(var i=1;i<=n;i++){drawLineSegment(jg,poly.getSide(i));}};function drawLineSegment(jg,line){var xfrom=line.getFirstPoint().x;var yfrom=line.getFirstPoint().y;var xto=line.getSecondPoint().x;var yto=line.getSecondPoint().y;var limitSides=getLimitSides();var xList=limitSides.getXList();var yList=limitSides.getYList();var xMin=Math.min.apply({},xList);var yMin=Math.min.apply({},yList);var xMax=Math.max.apply({},xList);var yMax=Math.max.apply({},yList);var points=new Array();if(xfrom>=xMin&&xfrom<=xMax&&yfrom>=yMin&&yfrom<=yMax){points.push(line.getFirstPoint());};if(xto>=xMin&&xto<=xMax&&yto>=yMin&&yto<=yMax){points.push(line.getSecondPoint());};var s=1;while(points.length<2&&s<=limitSides.getSidesNumber()){var intersectionPoint=limitSides.getSide(s).intersection(line);if(intersectionPoint !=null){points.push(intersectionPoint);};s++;};if(points.length==2){jg.drawLine(points[0].x,points[0].y,points[1].x,points[1].y);jg.paint();}};function getLimitSides(){var mapimgLayer=_$('mapimgLayer');var mapimgLayerL=objL(mapimgLayer);var mapimgLayerH=objT(mapimgLayer);var mapW=mapimgLayer.style.width;var mapH=mapimgLayer.style.height;var xMin=mapimgLayerL;var xMax=mapimgLayerL+parseInt(mapW);var yMin=mapimgLayerH;var yMax=mapimgLayerH+parseInt(mapH);var limitSides=new Polygon();limitSides.addPoint(new Point(xMin,yMin));limitSides.addPoint(new Point(xMax,yMin));limitSides.addPoint(new Point(xMax,yMax));limitSides.addPoint(new Point(xMin,yMax));limitSides.close();return limitSides;};function resetMeasure(){polyline.reset();jg.clear();jg_tmp.clear();reloadData();};function clearMeasure(){resetMeasure();geoPolyline.reset();};function reloadData(){if(polyline.getSidesNumber()==0){if(document.measureForm){document.measureForm.sumLen.value='';document.measureForm.segLen.value='';document.getElementById("mSegTxt").innerHTML=localeList['Segment']+pmMeasureUnits.distance;}}else if(polyline.isClosed()){onDigitizedPolygon(polyline);}else{onDigitizedSide(polyline);}};function reloadDrawing(){var varformMode=_$("varform").mode.value;if(varformMode=='measure'){resetMeasure();polyline=toPxPolygon(geoPolyline);if(polyline.getPointsNumber()>0){drawPolyline(jg,polyline);};reloadData();}};function delLastPoint(){var nPoints=polyline.getPointsNumber();if(nPoints>0){polyline.delPoint(nPoints-1);geoPolyline.delPoint(nPoints-1);reloadDrawing();}};function roundN(numin,rf){return(Math.round(numin*Math.pow(10,rf))/Math.pow(10,rf));}
 function PMap(){this.scale=null;this.resize_timer=null;};function pm_init(){pmToolbar_init();pmMenu_init();pmSlider_init();window.onresize=function(){pmLayout_init();};pmLayout_init();var imgTmpMap=_$("mapImg");imgTmpMap.onload=resetMapImgParams;imgTmpMap.onmouseover=startUp;pmTabs_init('#tocTabs','tab_toc');pmToc_init();if(navigator.userAgent.match(/Opera|Konqueror/i)){_$("zoombox").className='zoombox_nontransp';};createZSlider('zslider');setSearchOptions();domouseclick('zoomin');setTbTDButton('zoomin');pmIndicator_init();$(document).keypress(function(event){kp();});$('#mapimgLayer').mouseout(function(){setTimeout('mapImgMouseOut()',800);});$('#refMapImg').mouseover(function(){startUpRef();});};function pmSlider_init(){$('#sliderArea').hover(function(){$(this).addClass("sliderAreaOver").removeClass("sliderAreaOut");},function(){$(this).addClass("sliderAreaOut").removeClass("sliderAreaOver");});};function pmMenu_init(){$('ul.pm_menu>li').each(function(){$(this).hover(function(){$(this).addClass('pm_menu_hover');},function(){$(this).removeClass('pm_menu_hover');});$(this).click(function(){pmMenu_toggle($(this).parent().id());eval($(this).id().replace(/pmenu_/,'')+'()');});});};function pmMenu_toggle(menu){var obj=$('#'+menu);if(obj.css('display')=='none'){obj.show('fast');$('#'+menu+'_start>img').src('images/menuup.gif');}else{obj.hide('fast');$('#'+menu+'_start>img').src('images/menudown.gif');}};function pmToolbar_init(){if(PMap.tbImgSwap !=1){$('#mapZone .TOOLBARTD').each(function(){$(this).hover(function(){if(!$.className.has(this,"TOOLBARTD_ON"))$(this).addClass("TOOLBARTD_OVER");},function(){$(this).removeClass("TOOLBARTD_OVER");});});}else{$('#mapZone .TOOLBARTD').each(function(){$(this).hover(function(){if(!$(this).find('>img').src().match(/_on/))$(this).find('>img').imgSwap('_off','_over');},function(){$(this).find('>img').imgSwap('_over','_off');});});}};function pmCButton_init(but){$("#"+but).hover(function(){$(this).addClass("button_on").removeClass("button_off");},function(){$(this).addClass("button_off").removeClass("button_on");});};function pmCButton_init_all(){$("[@name='custombutton']").each(function(){$(this).hover(function(){$(this).addClass("button_on").removeClass("button_off");},function(){$(this).addClass("button_off").removeClass("button_on");});});};function pmTabs_init(tabdiv,activated){$(tabdiv+'>ul>li>a#'+activated).parent().addClass('tabs-selected');var numTabs=$(tabdiv+'>ul>li').length;var tabW=parseInt(100/numTabs)+'%';$(tabdiv+'>ul>li>a').each(function(){$(this).click(function(){$(tabdiv+'>ul>li').removeClass('tabs-selected');$(this).parent().addClass('tabs-selected');});$(this).parent().css('width',tabW);});};function pmIndicator_init(){$('body').append('<div id="pmIndicatorContainer" style="display:none;position:absolute;z-index:99"><img src="images/indicator.gif" alt="wait"/></div>');};function contextMenus_init(){if(typeof(pmContextMenuList)!="undefined"){$.each(pmContextMenuList,function(){var cmdiv='<div style="display:none" class="contextMenu" id="'+this.menuid+'">';var cmbindings={};cmdiv+='<ul>';$.each(this.menulist,function(){cmdiv+='<li id="'+this.id+'">';if(this.imgsrc)cmdiv+='<img src="images/menus/'+this.imgsrc+'"/>';cmdiv+=_p(this.text)+'</li>';var run=this.run;cmbindings[this.id]=function(t){eval(run+'("'+t.id+'")')};});$('body').append(cmdiv);$(this.bindto).contextMenu(this.menuid,{bindings: cmbindings,menuStyle: this.styles.menuStyle,itemStyle: this.styles.itemStyle,itemHoverStyle: this.styles.itemHoverStyle});});}};function showGroup(gid){}
 if(typeof(queryResultLayout)=="undefined"){if(typeof(opener.queryResultLayout)=="undefined"){var queryResultLayout='table';}else{queryResultLayout=opener.queryResultLayout;}};function parseJSON(jsonstr,infoWin){var rhtml='';if(jsonstr==0)return returnNoResultHtml(infoWin);var groups=jsonstr[0];var jlen=groups.length;for(var i=0;i<jlen;i++){var layObj=groups[i];rhtml+='<div class="LAYERHEADER">'+layObj.description+'</div>';rhtml+='<table class="sortable" border="0" cellspacing="0" cellpadding="0">';var hL=layObj.header;if(hL[0]=='@'){var withShpLink=true;}else{var withShpLink=false;};var hLlen=hL.length;rhtml+='<tr>';var startcol=withShpLink?0 : 1;for(var hi=startcol;hi<hLlen;hi++){rhtml+='<th>'+hL[hi]+'</th>';};rhtml+='</tr>';var vL=layObj.values;var vLlen=vL.length;for(var vi=0;vi<vLlen;vi++){var rowL=vL[vi];var rowLlen=rowL.length;rhtml+='<tr>';for(var ri=startcol;ri<rowLlen;ri++){if(withShpLink&&ri<1){var shplinkL=rowL[ri].shplink;rhtml+='<td class=\"zoomlink\"><a href="javascript:'+(infoWin !='window'?'' : 'opener.')+'zoom2extent(\''+shplinkL[0]+'\',\''+shplinkL[1]+'\',\''+shplinkL[2]+'\')">';rhtml+='<img src="images/zoomto.gif" alt="zoomto"></a></td>';}else{if(isObject(rowL[ri])){var hypLinkL=rowL[ri].hyperlink;rhtml+='<td><a href="javascript:openHyperlink(\''+hypLinkL[0]+'\',\''+hypLinkL[1]+'\',\''+hypLinkL[2].replace(/"|'/,'\\\'')+'\')">'+hypLinkL[3]+'</a></td>';}else{rhtml+='<td>'+rowL[ri]+'</td>';}}};rhtml+='</tr>';};rhtml+='</table>';};var zp=jsonstr[1];rhtml+=returnZoomParamsHtml(zp,infoWin);try{rhtml+=returnCustomQueryHtml(zp,infoWin);}catch(e){};return rhtml;};function parseJSON_treeview(jsonstr,infoWin){var rhtml='';if(jsonstr==0)return returnNoResultHtml(infoWin);try{if(infoWin=='window'){var treeCss='id="'+opener.queryTreeStyle['css']+'"';}else{var treeCss='id="'+queryTreeStyle['css']+'"';}}catch(e){var treeCss="";};var t=localeList['Layer']+'<ul '+treeCss+'>';var groups=jsonstr[0];var jlen=groups.length;for(var i=0;i<jlen;i++){var layObj=groups[i];t+='<li>'+layObj.description;t+='<ul>';var hL=layObj.header;if(hL[0]=='@'){var withShpLink=true;}else{var withShpLink=false;};var hLlen=hL.length;var startcol=withShpLink?0 : 1;var n4node=withShpLink?1 : 0;var vL=layObj.values;var vLlen=vL.length;for(var vi=0;vi<vLlen;vi++){var rowL=vL[vi];var rowLlen=rowL.length;if(isObject(rowL[n4node])){var nodeAnnot=rowL[n4node].hyperlink[3];}else{var nodeAnnot=rowL[n4node];};t+='<li>'+nodeAnnot+'<ul>';for(var ri=startcol;ri<rowLlen;ri++){if(withShpLink&&ri<1){var shplinkL=rowL[ri].shplink;var zoomlink='<a href="javascript:'+(infoWin !='window'?'' : 'opener.')+'zoom2extent(\''+shplinkL[0]+'\',\''+shplinkL[1]+'\',\''+shplinkL[2]+'\')">';t+='<li>'+zoomlink+'<img src="images/zoomtiny.gif" alt=""/>Zoom</a></li>';}else{t+='<li><span class="qcname">'+hL[ri]+'</span>: &nbsp;';if(isObject(rowL[ri])){var hypLinkL=rowL[ri].hyperlink;var hlink='<a href="javascript:openHyperlink(\''+hypLinkL[0]+'\',\''+hypLinkL[1]+'\',\''+hypLinkL[2]+'\')">';t+=hlink+hypLinkL[3]+'</a>';}else{var hlink='';t+=rowL[ri];};t+='</li>';}};t+='</ul>';t+='</li>';};t+='</ul>';t+='</li>';};t+='</ul>';rhtml+=t;var zp=jsonstr[1];rhtml+=returnZoomParamsHtml(zp,infoWin);try{rhtml+=returnCustomQueryHtml(zp,infoWin);}catch(e){};return rhtml;};function returnNoResultHtml(infoWin){var h='<table class="restable" cellspacing="0" cellpadding="0">';h+='<td>'+localeList['noRecords']+'</td>';if(infoWin=='window')h+='<td><a href="javascript:this.close();"><img align="right" src="images/close.gif" border=0></a></td>';h+='</tr></table>';return h;};function returnZoomParamsHtml(zp,infoWin){var infoWin=zp.infoWin;var allextent=zp.allextent;var autozoom=zp.autozoom;var zoomall=zp.zoomall;var ref2opener=(infoWin !='window'?'' : 'opener.');PMap.extentSelectedFeatures=allextent;var html='';if(zoomall){var zStr='<table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" width=\"100%\"><tr><td class=\"zoomlink\">';zStr+="<a href=\"javascript:";zStr+=ref2opener+'zoom2extent(0,0,\''+allextent+'\')';zStr+='\"><img src=\"images/zoomtoall.gif\"alt=\"za\"></a></td><td class=\"TDAL\">'+localeList['zoomSelected']+'</td></tr></table>';html+=zStr;};var azStr='<img src=\"images/blank.gif\" onload=\"';if(autozoom){if(autozoom=='auto'){azStr+=ref2opener+'zoom2extent(0,0,\''+allextent+'\');';}else if(autozoom=='highlight'){azStr+=ref2opener+'updateMap('+ref2opener+'PM_XAJAX_LOCATION+\'x_load.php?'+SID+'&mode=map&zoom_type=zoompoint\',\'\')';}}else{azStr+=ref2opener+'$(\'#zoombox\').hidev();';};azStr+='\"/>';html+=azStr;return html;};function parseJSON_IQuery(jsonstr){if(jsonstr==0){return false;};var groups=jsonstr[0];var layObj=groups[0];var startcol=1;var hL=layObj.header;var hLlen=hL.length;var vL=layObj.values;var rowL=vL[0];var rhtml='';rhtml+='<table class="iquery" border="0" cellspacing="0" cellpadding="0">';rhtml+='<tr><th colspan="2" class="header">'+layObj.description+'</td></tr>';for(var hi=startcol;hi<hLlen;hi++){rhtml+='<tr>';rhtml+='<th>'+hL[hi]+'</th>';if(isObject(rowL[hi])){var hypLinkL=rowL[hi].hyperlink;rhtml+='<td>'+hypLinkL[3]+'</td>';}else{rhtml+='<td>'+rowL[hi]+'</td>';};rhtml+='</tr>';};rhtml+='</table>';return rhtml;};function writeQResult(resultJSON,infoWin){var queryResultDiv=infoWin=='window'?'queryResult' : 'infoFrame';if(queryResultLayout=='table'){var resstr=parseJSON(resultJSON,infoWin);if(infoWin=='dynwin'){createDnRDlg({w:400,h:200},{resizeable:true,newsize:false},'pmQueryContainer','Result',false);$('#pmQueryContainer_MSG').html(resstr).addClass('pmInfo').addClass('jqmdQueryMSG');}else{$('#'+queryResultDiv).html(resstr);};sortables_init();}else{var restree=parseJSON_treeview(resultJSON,infoWin);if(infoWin=='dynwin'){createDnRDlg({w:600,h:200},{resizeable:true,newsize:false},'pmQueryContainer',localeList['Result'],false);$('#pmQueryContainer_MSG').html(restree).addClass('jqmdQueryMSG');queryResultDiv='pmQueryContainer_MSG';}else{$('#'+queryResultDiv).html(restree);};try{if(infoWin=='window'){var treeStyle=opener.queryTreeStyle['treeview'];}else{var treeStyle=queryTreeStyle['treeview'];}}catch(e){var treeStyle={collapsed: true,unique: true};}$('#'+queryResultDiv+'>ul').Treeview(treeStyle);}};function isObject(a){return(a&&typeof a=='object')||typeof a=='function';}
 function PM_Query(){this.iquery_timer=null;try{this.follow=autoIdentifyFollowMouse;}catch(e){this.follow=false;};this.timeW=-1;this.timeA=2;this.timer_c=0;this.timer_t=null;this.timer_to=null;};function showqueryresult(type,xy){var pos=xy.split('+');if(type=='query'){var mx=pos[0];var my=pos[1];}else{var mx=pos[2];var my=pos[3];};pmIndicator_show(mx,my);var queryurl=PM_XAJAX_LOCATION+'x_info.php';var varform=document.getElementById("varform");if(type=='query'){var qparams=SID+'&mode='+type+'&imgxy='+xy;}else{var qparams=SID+'&mode='+type+'&imgxy='+xy+'&groups='+getSelectLayer();varform.zoomselected.value='1';};if(PMap.infoWin=='window'){openResultwin('blank.html');};getQueryResult(queryurl,qparams);};function submitSearch(){pmIndicator_show(false,false);var searchForm=_$('searchForm');var skvp=getFormKVP('searchForm');if(PMap.infoWin !='window'){searchForm.target='infoZone';}else{var resultwin=openResultwin('blank.html');searchForm.target='resultwin';};var queryurl=PM_XAJAX_LOCATION+'x_info.php';var params=SID+'&'+skvp+'&mode=search';getQueryResult(queryurl,params);};function getSelectLayer(){var selform=_$("selform");if(selform){if(selform.selgroup){var sellayer=selform.selgroup.options[selform.selgroup.selectedIndex].value;var layerstring="&groups="+sellayer;return sellayer;}else{return false;}}else{return false;}};function applyIquery(mx,my){var imgxy=mx+"+"+my;var queryurl=PM_XAJAX_LOCATION+'x_info.php?'+SID+'&mode=iquery'+'&imgxy='+imgxy+'&groups='+getSelectLayer();getQueryResult(queryurl,'');};function timedCount(moveX,moveY){if(PMQuery.timer_c==0){X=moveX;Y=moveY;};if(PMQuery.timer_c==1){PMQuery.iquery_timer=setTimeout("applyIquery("+X+","+Y+")",200);};PMQuery.timer_c+=1;PMQuery.timer_t=setTimeout("timedCount()",PMQuery.timeA);};function showIQueryResults(queryResult){var iQL=$('#iqueryLayer');var IQueryResult=parseJSON_IQuery(queryResult);var map=$('#mapImg');if(PMQuery.follow){var limitRG=map.iwidth()-iQL.iwidth()-4;var limitLF=0;var limitTP=0;var limitDN=map.iheight()-iQL.iheight()-4;var gap=10;var mapElem=_$('map');if(mapElem)mapElem.onmouseover=getGeoCoords;if(moveX>=limitRG){iQL.left(moveX-iQL.iwidth()-gap+'px');}else{iQL.left(moveX+gap+'px');};if(moveY>=limitDN){iQL.top(moveY-iQL.iheight()-gap+'px');}else{iQL.top(moveY+gap+'px');};if(IQueryResult){iQL.html(IQueryResult).showv();if(PMQuery.timeW !=-1)PMQuery.timer_to=setTimeout("hideIQL()",PMQuery.timeW);}else{iQL.html('').hidev();clearTimeout(PMQuery.timer_t);clearTimeout(PMQuery.iquery_timer);}}else{if(IQueryResult){iQL.html(IQueryResult).showv();}else{iQL.html('').hidev();}}};function hideIQL(){clearTimeout(PMQuery.iquery_timer);$('#iqueryLayer').hidev();};function mapImgMouseOut(){var vMode=_$("varform").mode.value;if(vMode=='iquery'||vMode=='nquery'){$('#iqueryLayer').hidev();}}
 function disableEnterKey(e){var key;if(window.event){key=window.event.keyCode;}else{key=e.which;};if(key==13){submitSearch();return false;}else{return true;}};function setSearchOptions(){var url=PM_XAJAX_LOCATION+'x_search.php?'+SID+'&action=optionlist';createSearchItems(url);};function setSearchInput(){var searchForm=_$('searchForm');var searchitem=searchForm.findlist.options[searchForm.findlist.selectedIndex].value;var url=PM_XAJAX_LOCATION+'x_search.php?'+SID+'&action=searchitem&searchitem='+searchitem;_$('searchForm').findlist.options[0].selected=true;createSearchItems(url);};function json2Select(jsonObj,fo){var html='<select name="'+jsonObj.selectname+'" ';var events=jsonObj.events;var size=jsonObj.size;if(size>0)html+=' size="'+size+'" multiple="multiple" ';if(events){html+=events;};html+='>';var options=jsonObj.options;if(fo !="0")html+='<option value=\"#\">'+fo+'</option>';for(var o in options){html+='<option value=\"'+o+'\">'+options[o]+'</option>';};html+='</select>';return html;};function createSearchInput(jsonObj){var searchitemsElem=$('#searchitems');var itemLayout=searchitemsElem.attr('class').replace(/pm_search_/,'');var searchitem=jsonObj.searchitem;var fields=jsonObj.fields;var hc='<table id="searchitems_container1" class="searchitem" border="0" cellspacing="0" cellpadding="0">';if(itemLayout=='inline'){hc+='<tr id="searchitems_container2"></tr>';var itemsAppendTo='searchitems_container2';}else{var itemsAppendTo='searchitems_container1';};hc+='</table>';searchitemsElem.html('');$(hc).appendTo(searchitemsElem);var html='';var htmlend='';for(var i=0;i<fields.length;i++){var description=fields[i].description;var fldname=fields[i].fldname;var fldsize=fields[i].fldsize;var fldsizedesc=fields[i].fldsizedesc;var fldinline=fields[i].fldinline;var definition=fields[i].definition;var inputsize=fldsize?' size="'+fldsize+'" ' : '';var sizedesc=fldsizedesc?' style="position:absolute;left:'+fldsizedesc+'em"' : '';if(!definition){var hi='<td class="searchdesc">'+description+'</td>';hi+='<td'+sizedesc+'>'+'<input type="text" class="search_textinput" id="pmsfld_'+fldname+'" name="'+fldname+'"'+inputsize+'></td>';if(itemLayout !="inline")hi='<tr>'+hi+'</tr>';$(hi).appendTo('#'+itemsAppendTo);}else{if(definition.type=='options'){var ho='<td class="searchdesc">'+description+'</td>';ho+='<td>'+json2Select(definition,definition.firstoption)+'</td>';if(itemLayout !="inline")ho='<tr>'+ho+'</tr>';$(ho).appendTo('#'+itemsAppendTo);}else if(definition.type=='suggest'){var hs='<td class="searchdesc">'+description+'</td>';hs+='<td><input type="text" id="pmsfld_'+fldname+'" name="'+fldname+'" alt="Search Criteria"'+inputsize+'/></td>';if(itemLayout !="inline")hs='<tr>'+hs+'</tr>';$(hs).appendTo('#'+itemsAppendTo);resetSuggestCache();var searchitem=definition.searchitem;var minlength=definition.minlength;var suggesturl=PM_XAJAX_LOCATION+'x_suggest.php?'+SID+'&searchitem='+searchitem+'&fldname='+fldname;$('#pmsfld_'+fldname).suggest(suggesturl,{delimiter: '||',minchars: minlength,delay:250,addToUrl: "getFormKVP('searchForm')",onSelect: function(){submitSearch()}});}else if(definition.type=='checkbox'){var value=definition.value;var defchecked='';var hcb='<td class="searchdesc">'+description+'</td>';hcb+='<td><input type="checkbox" id="pmsfld_'+fldname+'" name="'+fldname+'" '+'" value="'+value+'" '+defchecked+'/></td>';if(itemLayout !="inline")hcb='<tr>'+hcb+'</tr>';$(hcb).appendTo('#'+itemsAppendTo);}else if(definition.type=='radio'){var inputlist=definition.inputlist;for(var ipt in inputlist){var defchecked=(definition.checked==1)?' checked ' : '';var hra='<td>'+inputlist[ipt]+'</td>';hra+='<td><input type="radio" id="pmsfld_'+fldname+'" name="'+fldname+'" '+'" value="'+ipt+'" '+defchecked+'/></td>';}}else if(definition.type=='operator'){var hop='<td class="searchdesc">'+description+'</td>';hop+='<td'+sizedesc+'>'+json2Select(definition,false);hop+='<input type="text" class="search_textinput_compare" id="pmsfld_'+fldname+'" name="'+fldname+'" '+inputsize+'></td>';if(itemLayout !="inline")hop='<tr>'+hop+'</tr>';$(hop).appendTo('#'+itemsAppendTo);}else if(definition.type=='hidden'){htmlend+='<input type="hidden" id="pmsfld_'+fldname+'" name="'+fldname+'" value="'+definition.value+'">';}}};html+='<td colspan="2" class="searchitem">';html+='<div><input type="button" value="'+_p('Search')+'" size="20" ';html+='onclick="submitSearch()" onmouseover="changeButtonClr(this,\'over\')" onmouseout="changeButtonClr(this,\'out\')"></div>';html+='<div><img src="images/close.gif" alt="" onclick="$(\'#searchitems\').html(\'\')"/></div>';html+='</td>';htmlend+='<input type="hidden" name="searchitem" value="'+searchitem+'"/>';html+=htmlend;if(itemLayout !="inline")html='<tr>'+html+'</tr>';$(html).appendTo('#'+itemsAppendTo);};function getFormKVP(formid){var htmlform=document.getElementById(formid);var el=htmlform.elements;var s='';for(var i=0;i<el.length;i++){var e=el[i];var ename=e.name;var evalue=e.value;var etype=e.type;var delim=(i>0?'&' : '');if(evalue.length>0&&evalue !='#'){switch(etype){case 'select-one': s+=delim+ename+'='+e.options[e.selectedIndex].value;break;case 'select-multiple': var ol=e.options;var opttxt='';for(var o=0;o<ol.length;o++){if(ol[o].selected){opttxt+=ol[o].value+',';}};s+=delim+ename+'='+opttxt.substr(0,opttxt.length-1);break;case 'checkbox': if(e.checked){s+=delim+ename+'='+evalue;};break;case 'radio': if(e.checked){s+=delim+ename+'='+evalue;};break;default: s+=delim+ename+'='+evalue;break;}}};return s;};function resetSuggestCache(){cache=[];}
 var SORT_COLUMN_INDEX;function sortables_init(){if(!document.getElementsByTagName)return;var tbls=document.getElementsByTagName("table");for(ti=0;ti<tbls.length;ti++){thisTbl=tbls[ti];if(thisTbl.className=="sortable"){ts_makeSortable(thisTbl);}}};function ts_makeSortable(table){if(table.rows&&table.rows.length>0){var firstRow=table.rows[0];};if(!firstRow)return;for(var i=0;i<firstRow.cells.length;i++){var cell=firstRow.cells[i];var txt=ts_getInnerText(cell);var headerHtml='<a href="#" class="sortheader" onclick="ts_resortTable(this);return false;">'+txt+'<span class="sortarrow">&nbsp;&nbsp;&nbsp;</span></a>';cell.innerHTML=headerHtml;}};function ts_getInnerText(el){if(typeof el=="string")return el;if(typeof el=="undefined"){return el};if(el.innerText)return el.innerText;var str="";var cs=el.childNodes;var l=cs.length;for(var i=0;i<l;i++){switch(cs[i].nodeType){case 1: str+=ts_getInnerText(cs[i]);break;case 3: str+=cs[i].nodeValue;break;}};return str;};function ts_alignTables(){var tableList=document.getElementsByTagName("table");for(var t=0;t<tableList.length;t++){if(tableList[t].className=='sortable'){ts_alignCols(tableList[t]);}}};function ts_alignCols(table){if(!table.rows[1])return false;var colList=table.rows[1].cells;for(var cl=0;cl<colList.length;cl++){var itm=ts_getInnerText(table.rows[1].cells[cl]);align="left";if(table.rows[1].cells[cl].className=='zoomlink')align="center";if(itm.match(/^\d\d[\/-]\d\d[\/-]\d\d\d\d$/))align="right";if(itm.match(/^\d\d[\/-]\d\d[\/-]\d\d$/))align="right";if(itm.match(/^[$]/))align="right";if(itm.match(/^[\d\.]+$/))align="right";for(var r=0;r<table.rows.length;r++){if(table.rows[r].cells[cl]){table.rows[r].cells[cl].style.textAlign=align;}}}};function ts_resortTable(lnk){var span;for(var ci=0;ci<lnk.childNodes.length;ci++){if(lnk.childNodes[ci].tagName&&lnk.childNodes[ci].tagName.toLowerCase()=='span')span=lnk.childNodes[ci];};var spantext=ts_getInnerText(span);var td=lnk.parentNode;var column=td.cellIndex;var table=getParent(td,'TABLE');if(table.rows.length<=1)return;var itm=ts_getInnerText(table.rows[1].cells[column]);sortfn=ts_sort_caseinsensitive;if(itm.match(/^\d\d[\/-]\d\d[\/-]\d\d\d\d$/))sortfn=ts_sort_date;if(itm.match(/^\d\d[\/-]\d\d[\/-]\d\d$/))sortfn=ts_sort_date;if(itm.match(/^[$]/))sortfn=ts_sort_currency;if(itm.match(/^[\d\.]+$/))sortfn=ts_sort_numeric;SORT_COLUMN_INDEX=column;var firstRow=new Array();var newRows=new Array();for(i=0;i<table.rows[0].length;i++){firstRow[i]=table.rows[0][i];};for(j=1;j<table.rows.length;j++){newRows[j-1]=table.rows[j];};newRows.sort(sortfn);if(span.getAttribute("sortdir")=='down'){ARROW='&nbsp;&nbsp;<img src="images/upsimple.png">';newRows.reverse();span.setAttribute('sortdir','up');}else{ARROW='&nbsp;&nbsp;<img src="images/downsimple.png">';span.setAttribute('sortdir','down');};for(i=0;i<newRows.length;i++){if(!newRows[i].className||(newRows[i].className&&(newRows[i].className.indexOf('sortbottom')==-1)))table.tBodies[0].appendChild(newRows[i]);};for(i=0;i<newRows.length;i++){if(newRows[i].className&&(newRows[i].className.indexOf('sortbottom')!=-1))table.tBodies[0].appendChild(newRows[i]);};var allspans=document.getElementsByTagName("span");for(var ci=0;ci<allspans.length;ci++){if(allspans[ci].className=='sortarrow'){if(getParent(allspans[ci],"table")==getParent(lnk,"table")){allspans[ci].innerHTML='&nbsp;&nbsp;&nbsp;';}}};span.innerHTML=ARROW;};function getParent(el,pTagName){if(el==null)return null;else if(el.nodeType==1&&el.tagName.toLowerCase()==pTagName.toLowerCase())return el;else return getParent(el.parentNode,pTagName);};function ts_sort_date(a,b){aa=ts_getInnerText(a.cells[SORT_COLUMN_INDEX]);bb=ts_getInnerText(b.cells[SORT_COLUMN_INDEX]);if(aa.length==10){dt1=aa.substr(6,4)+aa.substr(3,2)+aa.substr(0,2);}else{yr=aa.substr(6,2);if(parseInt(yr)<50){yr='20'+yr;}else{yr='19'+yr;};dt1=yr+aa.substr(3,2)+aa.substr(0,2);};if(bb.length==10){dt2=bb.substr(6,4)+bb.substr(3,2)+bb.substr(0,2);}else{yr=bb.substr(6,2);if(parseInt(yr)<50){yr='20'+yr;}else{yr='19'+yr;};dt2=yr+bb.substr(3,2)+bb.substr(0,2);};if(dt1==dt2)return 0;if(dt1<dt2)return-1;return 1;};function ts_sort_currency(a,b){aa=ts_getInnerText(a.cells[SORT_COLUMN_INDEX]).replace(/[^0-9.]/g,'');bb=ts_getInnerText(b.cells[SORT_COLUMN_INDEX]).replace(/[^0-9.]/g,'');return parseFloat(aa)-parseFloat(bb);};function ts_sort_numeric(a,b){aa=parseFloat(ts_getInnerText(a.cells[SORT_COLUMN_INDEX]));if(isNaN(aa))aa=0;bb=parseFloat(ts_getInnerText(b.cells[SORT_COLUMN_INDEX]));if(isNaN(bb))bb=0;return aa-bb;};function ts_sort_caseinsensitive(a,b){aa=ts_getInnerText(a.cells[SORT_COLUMN_INDEX]).toLowerCase();bb=ts_getInnerText(b.cells[SORT_COLUMN_INDEX]).toLowerCase();if(aa==bb)return 0;if(aa<bb)return-1;return 1;};function ts_sort_default(a,b){aa=ts_getInnerText(a.cells[SORT_COLUMN_INDEX]);bb=ts_getInnerText(b.cells[SORT_COLUMN_INDEX]);if(aa==bb)return 0;if(aa<bb)return-1;return 1;};function addEvent(elm,evType,fn,useCapture){if(elm.addEventListener){elm.addEventListener(evType,fn,useCapture);return true;}else if(elm.attachEvent){var r=elm.attachEvent("on"+evType,fn);return r;}else{alert("Handler could not be removed");}}
 function pmToc_init(){var tocurl=PM_XAJAX_LOCATION+'x_toc.php?'+SID;updateToc(tocurl);};function treeInit(catStyle,grpStyle){var catcList=$('div.catc');for(var i=0;i<catcList.length;i++){catcList[i].style.display='none';tg(catcList[i].id);};if(PMap.grpStyle=='tree'){$('div.grpc').hide();};setDefGroups();$("#toc input[@name='catscbx']").check('on');tocPostLoading();};function tocPostLoading(){contextMenus_init();for(var i=0;i<PMap.pluginTocInit.length;i++){eval(PMap.pluginTocInit[i]);}};function tg(group){var divobj=$('#'+group);if(divobj.css('display')=='none'){$('#'+group+'_timg').src('images/tree/minus.gif');divobj.show();}else{$('#'+group+'_timg').src('images/tree/plus.gif');divobj.hide();}};function showPopupLegend(){var tocurl=PM_XAJAX_LOCATION+'x_toc.php?'+SID+'&legendonly=1';showMapLegend(tocurl);};function swapToLegendView(){var tocurl=PM_XAJAX_LOCATION+'x_toc.php?'+SID+'&legendonly=1&swaplegend=1';swapLegend(tocurl);};function swapToLayerView(){$('#toclegend').hide();$('#toc').fadeIn('normal');var tocurl=PM_XAJAX_LOCATION+'x_toc_update.php?'+SID;updateTocScale(tocurl);};function setDefGroups(){var defGroupListL=PMap.defGroupList.length;if(defGroupListL>0){for(var x=0;x<defGroupListL;x++){var chkGrp=_$(PMap.defGroupList[x]);if(chkGrp){chkGrp.checked=true;}}}};function setlayers(selelem,noreload){if(selelem){if((_$('spxg_'+selelem).className=='unvis')&&(!noreload)){noreload=true;};if(PMap.mutualDisableList){var mdl=PMap.mutualDisableList;if(mdl.inArray(selelem)){for(var i=0;i<mdl.length;i++){if(mdl[i] !=selelem){_$('ginput_'+mdl[i]).checked=false;}}}}};var layerstring='&groups='+getLayers();if((PMap.layerAutoRefresh=='1')&&(!noreload)){showloading();var mapurl=PM_XAJAX_LOCATION+'x_load.php?'+SID+'&zoom_type=zoompoint'+layerstring;updateMap(mapurl);}else{var passurl=PM_XAJAX_LOCATION+'x_layer_update.php?'+SID+layerstring;updateSelLayers(passurl);}};function getLayers(){var laystr='';$("#layerform :input[@name='groupscbx'][@checked]").not(':disabled').each(function(){laystr+=$(this).val()+',';});laystr=laystr.substr(0,laystr.length-1);return laystr;};function setcategories(cat){var cat_activated=$('#cinput_'+cat).is(':checked');var grpList=$('#'+cat).find('input[@type="checkbox"]');var checkedLayers=false;var visLayers=false;for(var i=0;i<grpList.length;i++){var grp=grpList[i];if(cat_activated){grp.disabled=false;}else{grp.disabled=true;};if(grp.checked){checkedLayers=true;if(_$('spxg_'+(grp.id.replace(/ginput_/,''))).className=='vis'){visLayers=true;}}};if(checkedLayers&&visLayers){setlayers(false,false);}else{setlayers(false,true);}};function tocResizeUpdate(){var tocCont=$('#tocContainer');var parentH=tocCont.parent().iheight();var tDelta=0;$('#tocContainer').parent().find('>div').not('#tocContainer').each(function(){tDelta+=parseInt($(this).height());});var tocDeltaH=(tDelta>0?tDelta : $('#tocContainer').itop());$('#tocContainer').top(tocDeltaH+'px').height((parentH-tocDeltaH-5)+'px');}
 var jg_ihtm,jg_ie,jg_fast,jg_dom,jg_moz,jg_n4=(document.layers&&typeof document.classes !="undefined");function chkDHTM(x,i){x=document.body||null;jg_ie=x&&typeof x.insertAdjacentHTML !="undefined";jg_dom=(x&&!jg_ie&&typeof x.appendChild !="undefined"&&typeof document.createRange !="undefined"&&typeof(i=document.createRange()).setStartBefore !="undefined"&&typeof i.createContextualFragment !="undefined");jg_ihtm=!jg_ie&&!jg_dom&&x&&typeof x.innerHTML !="undefined";jg_fast=jg_ie&&document.all&&!window.opera;jg_moz=jg_dom&&typeof x.style.MozOpacity !="undefined";};function pntDoc(){this.wnd.document.write(jg_fast?this.htmRpc(): this.htm);this.htm='';};function pntCnvDom(){var x=document.createRange();x.setStartBefore(this.cnv);x=x.createContextualFragment(jg_fast?this.htmRpc(): this.htm);this.cnv.appendChild(x);this.htm='';};function pntCnvIe(){this.cnv.insertAdjacentHTML("BeforeEnd",jg_fast?this.htmRpc(): this.htm);this.htm='';};function pntCnvIhtm(){this.cnv.innerHTML+=this.htm;this.htm='';};function pntCnv(){this.htm='';};function mkDiv(x,y,w,h){this.htm+='<div style="position:absolute;'+'left:'+x+'px;'+'top:'+y+'px;'+'width:'+w+'px;'+'height:'+h+'px;'+'clip:rect(0,'+w+'px,'+h+'px,0);'+'background-color:'+this.color+(!jg_moz?';overflow:hidden' : '')+';"><\/div>';};function mkDivIe(x,y,w,h){this.htm+='%%'+this.color+';'+x+';'+y+';'+w+';'+h+';';};function mkDivPrt(x,y,w,h){this.htm+='<div style="position:absolute;'+'border-left:'+w+'px solid '+this.color+';'+'left:'+x+'px;'+'top:'+y+'px;'+'width:0px;'+'height:'+h+'px;'+'clip:rect(0,'+w+'px,'+h+'px,0);'+'background-color:'+this.color+(!jg_moz?';overflow:hidden' : '')+';"><\/div>';};function mkLyr(x,y,w,h){this.htm+='<layer '+'left="'+x+'" '+'top="'+y+'" '+'width="'+w+'" '+'height="'+h+'" '+'bgcolor="'+this.color+'"><\/layer>\n';};var regex=/%%([^;]+);([^;]+);([^;]+);([^;]+);([^;]+);/g;function htmRpc(){return this.htm.replace(regex,'<div style="overflow:hidden;position:absolute;background-color:'+'$1;left:$2;top:$3;width:$4;height:$5"></div>\n');};function htmPrtRpc(){return this.htm.replace(regex,'<div style="overflow:hidden;position:absolute;background-color:'+'$1;left:$2;top:$3;width:$4;height:$5;border-left:$4px solid $1"></div>\n');};function mkLin(x1,y1,x2,y2){if(x1>x2){var _x2=x2;var _y2=y2;x2=x1;y2=y1;x1=_x2;y1=_y2;};var dx=x2-x1,dy=Math.abs(y2-y1),x=x1,y=y1,yIncr=(y1>y2)?-1 : 1;if(dx>=dy){var pr=dy<<1,pru=pr-(dx<<1),p=pr-dx,ox=x;while((dx--)>0){++x;if(p>0){this.mkDiv(ox,y,x-ox,1);y+=yIncr;p+=pru;ox=x;}else p+=pr;};this.mkDiv(ox,y,x2-ox+1,1);}else{var pr=dx<<1,pru=pr-(dy<<1),p=pr-dy,oy=y;if(y2<=y1){while((dy--)>0){if(p>0){this.mkDiv(x++,y,1,oy-y+1);y+=yIncr;p+=pru;oy=y;}else{y+=yIncr;p+=pr;}};this.mkDiv(x2,y2,1,oy-y2+1);}else{while((dy--)>0){y+=yIncr;if(p>0){this.mkDiv(x++,oy,1,y-oy);p+=pru;oy=y;}else p+=pr;};this.mkDiv(x2,oy,1,y2-oy+1);}}};function mkLin2D(x1,y1,x2,y2){if(x1>x2){var _x2=x2;var _y2=y2;x2=x1;y2=y1;x1=_x2;y1=_y2;};var dx=x2-x1,dy=Math.abs(y2-y1),x=x1,y=y1,yIncr=(y1>y2)?-1 : 1;var s=this.stroke;if(dx>=dy){if(s-3>0){var _s=(s*dx*Math.sqrt(1+dy*dy/(dx*dx))-dx-(s>>1)*dy)/dx;_s=(!(s-4)?Math.ceil(_s): Math.round(_s))+1;}else var _s=s;var ad=Math.ceil(s/2);var pr=dy<<1,pru=pr-(dx<<1),p=pr-dx,ox=x;while((dx--)>0){++x;if(p>0){this.mkDiv(ox,y,x-ox+ad,_s);y+=yIncr;p+=pru;ox=x;}else p+=pr;};this.mkDiv(ox,y,x2-ox+ad+1,_s);}else{if(s-3>0){var _s=(s*dy*Math.sqrt(1+dx*dx/(dy*dy))-(s>>1)*dx-dy)/dy;_s=(!(s-4)?Math.ceil(_s): Math.round(_s))+1;}else var _s=s;var ad=Math.round(s/2);var pr=dx<<1,pru=pr-(dy<<1),p=pr-dy,oy=y;if(y2<=y1){++ad;while((dy--)>0){if(p>0){this.mkDiv(x++,y,_s,oy-y+ad);y+=yIncr;p+=pru;oy=y;}else{y+=yIncr;p+=pr;}};this.mkDiv(x2,y2,_s,oy-y2+ad);}else{while((dy--)>0){y+=yIncr;if(p>0){this.mkDiv(x++,oy,_s,y-oy+ad);p+=pru;oy=y;}else p+=pr;};this.mkDiv(x2,oy,_s,y2-oy+ad+1);}}};function mkLinDott(x1,y1,x2,y2){if(x1>x2){var _x2=x2;var _y2=y2;x2=x1;y2=y1;x1=_x2;y1=_y2;};var dx=x2-x1,dy=Math.abs(y2-y1),x=x1,y=y1,yIncr=(y1>y2)?-1 : 1,drw=true;if(dx>=dy){var pr=dy<<1,pru=pr-(dx<<1),p=pr-dx;while((dx--)>0){if(drw)this.mkDiv(x,y,1,1);drw=!drw;if(p>0){y+=yIncr;p+=pru;}else p+=pr;++x;};if(drw)this.mkDiv(x,y,1,1);}else{var pr=dx<<1,pru=pr-(dy<<1),p=pr-dy;while((dy--)>0){if(drw)this.mkDiv(x,y,1,1);drw=!drw;y+=yIncr;if(p>0){++x;p+=pru;}else p+=pr;};if(drw)this.mkDiv(x,y,1,1);}};function mkOv(left,top,width,height){var a=width>>1,b=height>>1,wod=width&1,hod=(height&1)+1,cx=left+a,cy=top+b,x=0,y=b,ox=0,oy=b,aa=(a*a)<<1,bb=(b*b)<<1,st=(aa>>1)*(1-(b<<1))+bb,tt=(bb>>1)-aa*((b<<1)-1),w,h;while(y>0){if(st<0){st+=bb*((x<<1)+3);tt+=(bb<<1)*(++x);}else if(tt<0){st+=bb*((x<<1)+3)-(aa<<1)*(y-1);tt+=(bb<<1)*(++x)-aa*(((y--)<<1)-3);w=x-ox;h=oy-y;if(w&2&&h&2){this.mkOvQds(cx,cy,-x+2,ox+wod,-oy,oy-1+hod,1,1);this.mkOvQds(cx,cy,-x+1,x-1+wod,-y-1,y+hod,1,1);}else this.mkOvQds(cx,cy,-x+1,ox+wod,-oy,oy-h+hod,w,h);ox=x;oy=y;}else{tt-=aa*((y<<1)-3);st-=(aa<<1)*(--y);}};this.mkDiv(cx-a,cy-oy,a-ox+1,(oy<<1)+hod);this.mkDiv(cx+ox+wod,cy-oy,a-ox+1,(oy<<1)+hod);};function mkOv2D(left,top,width,height){var s=this.stroke;width+=s-1;height+=s-1;var a=width>>1,b=height>>1,wod=width&1,hod=(height&1)+1,cx=left+a,cy=top+b,x=0,y=b,aa=(a*a)<<1,bb=(b*b)<<1,st=(aa>>1)*(1-(b<<1))+bb,tt=(bb>>1)-aa*((b<<1)-1);if(s-4<0&&(!(s-2)||width-51>0&&height-51>0)){var ox=0,oy=b,w,h,pxl,pxr,pxt,pxb,pxw;while(y>0){if(st<0){st+=bb*((x<<1)+3);tt+=(bb<<1)*(++x);}else if(tt<0){st+=bb*((x<<1)+3)-(aa<<1)*(y-1);tt+=(bb<<1)*(++x)-aa*(((y--)<<1)-3);w=x-ox;h=oy-y;if(w-1){pxw=w+1+(s&1);h=s;}else if(h-1){pxw=s;h+=1+(s&1);}else pxw=h=s;this.mkOvQds(cx,cy,-x+1,ox-pxw+w+wod,-oy,-h+oy+hod,pxw,h);ox=x;oy=y;}else{tt-=aa*((y<<1)-3);st-=(aa<<1)*(--y);}};this.mkDiv(cx-a,cy-oy,s,(oy<<1)+hod);this.mkDiv(cx+a+wod-s+1,cy-oy,s,(oy<<1)+hod);}else{var _a=(width-((s-1)<<1))>>1,_b=(height-((s-1)<<1))>>1,_x=0,_y=_b,_aa=(_a*_a)<<1,_bb=(_b*_b)<<1,_st=(_aa>>1)*(1-(_b<<1))+_bb,_tt=(_bb>>1)-_aa*((_b<<1)-1),pxl=new Array(),pxt=new Array(),_pxb=new Array();pxl[0]=0;pxt[0]=b;_pxb[0]=_b-1;while(y>0){if(st<0){st+=bb*((x<<1)+3);tt+=(bb<<1)*(++x);pxl[pxl.length]=x;pxt[pxt.length]=y;}else if(tt<0){st+=bb*((x<<1)+3)-(aa<<1)*(y-1);tt+=(bb<<1)*(++x)-aa*(((y--)<<1)-3);pxl[pxl.length]=x;pxt[pxt.length]=y;}else{tt-=aa*((y<<1)-3);st-=(aa<<1)*(--y);};if(_y>0){if(_st<0){_st+=_bb*((_x<<1)+3);_tt+=(_bb<<1)*(++_x);_pxb[_pxb.length]=_y-1;}else if(_tt<0){_st+=_bb*((_x<<1)+3)-(_aa<<1)*(_y-1);_tt+=(_bb<<1)*(++_x)-_aa*(((_y--)<<1)-3);_pxb[_pxb.length]=_y-1;}else{_tt-=_aa*((_y<<1)-3);_st-=(_aa<<1)*(--_y);_pxb[_pxb.length-1]--;}}};var ox=0,oy=b,_oy=_pxb[0],l=pxl.length,w,h;for(var i=0;i<l;i++){if(typeof _pxb[i] !="undefined"){if(_pxb[i]<_oy||pxt[i]<oy){x=pxl[i];this.mkOvQds(cx,cy,-x+1,ox+wod,-oy,_oy+hod,x-ox,oy-_oy);ox=x;oy=pxt[i];_oy=_pxb[i];}}else{x=pxl[i];this.mkDiv(cx-x+1,cy-oy,1,(oy<<1)+hod);this.mkDiv(cx+ox+wod,cy-oy,1,(oy<<1)+hod);ox=x;oy=pxt[i];}};this.mkDiv(cx-a,cy-oy,1,(oy<<1)+hod);this.mkDiv(cx+ox+wod,cy-oy,1,(oy<<1)+hod);}};function mkOvDott(left,top,width,height){var a=width>>1,b=height>>1,wod=width&1,hod=height&1,cx=left+a,cy=top+b,x=0,y=b,aa2=(a*a)<<1,aa4=aa2<<1,bb=(b*b)<<1,st=(aa2>>1)*(1-(b<<1))+bb,tt=(bb>>1)-aa2*((b<<1)-1),drw=true;while(y>0){if(st<0){st+=bb*((x<<1)+3);tt+=(bb<<1)*(++x);}else if(tt<0){st+=bb*((x<<1)+3)-aa4*(y-1);tt+=(bb<<1)*(++x)-aa2*(((y--)<<1)-3);}else{tt-=aa2*((y<<1)-3);st-=aa4*(--y);};if(drw)this.mkOvQds(cx,cy,-x,x+wod,-y,y+hod,1,1);drw=!drw;}};function mkRect(x,y,w,h){var s=this.stroke;this.mkDiv(x,y,w,s);this.mkDiv(x+w,y,s,h);this.mkDiv(x,y+h,w+s,s);this.mkDiv(x,y+s,s,h-s);};function mkRectDott(x,y,w,h){this.drawLine(x,y,x+w,y);this.drawLine(x+w,y,x+w,y+h);this.drawLine(x,y+h,x+w,y+h);this.drawLine(x,y,x,y+h);};function jsgFont(){this.PLAIN='font-weight:normal;';this.BOLD='font-weight:bold;';this.ITALIC='font-style:italic;';this.ITALIC_BOLD=this.ITALIC+this.BOLD;this.BOLD_ITALIC=this.ITALIC_BOLD;};var Font=new jsgFont();function jsgStroke(){this.DOTTED=-1;};var Stroke=new jsgStroke();function jsGraphics(id,wnd){this.setColor=new Function('arg','this.color=arg.toLowerCase();');this.setStroke=function(x){this.stroke=x;if(!(x+1)){this.drawLine=mkLinDott;this.mkOv=mkOvDott;this.drawRect=mkRectDott;}else if(x-1>0){this.drawLine=mkLin2D;this.mkOv=mkOv2D;this.drawRect=mkRect;}else{this.drawLine=mkLin;this.mkOv=mkOv;this.drawRect=mkRect;}};this.setPrintable=function(arg){this.printable=arg;if(jg_fast){this.mkDiv=mkDivIe;this.htmRpc=arg?htmPrtRpc : htmRpc;}else this.mkDiv=jg_n4?mkLyr : arg?mkDivPrt : mkDiv;};this.setFont=function(fam,sz,sty){this.ftFam=fam;this.ftSz=sz;this.ftSty=sty||Font.PLAIN;};this.drawPolyline=this.drawPolyLine=function(x,y,s){for(var i=0;i<x.length-1;i++)this.drawLine(x[i],y[i],x[i+1],y[i+1]);};this.fillRect=function(x,y,w,h){this.mkDiv(x,y,w,h);};this.drawPolygon=function(x,y){this.drawPolyline(x,y);this.drawLine(x[x.length-1],y[x.length-1],x[0],y[0]);};this.drawEllipse=this.drawOval=function(x,y,w,h){this.mkOv(x,y,w,h);};this.fillEllipse=this.fillOval=function(left,top,w,h){var a=(w-=1)>>1,b=(h-=1)>>1,wod=(w&1)+1,hod=(h&1)+1,cx=left+a,cy=top+b,x=0,y=b,ox=0,oy=b,aa2=(a*a)<<1,aa4=aa2<<1,bb=(b*b)<<1,st=(aa2>>1)*(1-(b<<1))+bb,tt=(bb>>1)-aa2*((b<<1)-1),pxl,dw,dh;if(w+1)while(y>0){if(st<0){st+=bb*((x<<1)+3);tt+=(bb<<1)*(++x);}else if(tt<0){st+=bb*((x<<1)+3)-aa4*(y-1);pxl=cx-x;dw=(x<<1)+wod;tt+=(bb<<1)*(++x)-aa2*(((y--)<<1)-3);dh=oy-y;this.mkDiv(pxl,cy-oy,dw,dh);this.mkDiv(pxl,cy+oy-dh+hod,dw,dh);ox=x;oy=y;}else{tt-=aa2*((y<<1)-3);st-=aa4*(--y);}};this.mkDiv(cx-a,cy-oy,w+1,(oy<<1)+hod);};this.fillPolygon=function(array_x,array_y){var i;var y;var miny,maxy;var x1,y1;var x2,y2;var ind1,ind2;var ints;var n=array_x.length;if(!n)return;miny=array_y[0];maxy=array_y[0];for(i=1;i<n;i++){if(array_y[i]<miny)miny=array_y[i];if(array_y[i]>maxy)maxy=array_y[i];};for(y=miny;y<=maxy;y++){var polyInts=new Array();ints=0;for(i=0;i<n;i++){if(!i){ind1=n-1;ind2=0;}else{ind1=i-1;ind2=i;};y1=array_y[ind1];y2=array_y[ind2];if(y1<y2){x1=array_x[ind1];x2=array_x[ind2];}else if(y1>y2){y2=array_y[ind1];y1=array_y[ind2];x2=array_x[ind1];x1=array_x[ind2];}else continue;if((y>=y1)&&(y<y2))polyInts[ints++]=Math.round((y-y1)*(x2-x1)/(y2-y1)+x1);else if((y==maxy)&&(y>y1)&&(y<=y2))polyInts[ints++]=Math.round((y-y1)*(x2-x1)/(y2-y1)+x1);};polyInts.sort(integer_compare);for(i=0;i<ints;i+=2){w=polyInts[i+1]-polyInts[i];this.mkDiv(polyInts[i],y,polyInts[i+1]-polyInts[i]+1,1);}}};this.drawString=function(txt,x,y){this.htm+='<div style="position:absolute;white-space:nowrap;'+'left:'+x+'px;'+'top:'+y+'px;'+'font-family:'+this.ftFam+';'+'font-size:'+this.ftSz+';'+'color:'+this.color+';'+this.ftSty+'">'+txt+'<\/div>';};this.drawImage=function(imgSrc,x,y,w,h){this.htm+='<div style="position:absolute;'+'left:'+x+'px;'+'top:'+y+'px;'+'width:'+w+';'+'height:'+h+';">'+'<img src="'+imgSrc+'" width="'+w+'" height="'+h+'">'+'<\/div>';};this.clear=function(){this.htm="";if(this.cnv)this.cnv.innerHTML=this.defhtm;};this.mkOvQds=function(cx,cy,xl,xr,yt,yb,w,h){this.mkDiv(xr+cx,yt+cy,w,h);this.mkDiv(xr+cx,yb+cy,w,h);this.mkDiv(xl+cx,yb+cy,w,h);this.mkDiv(xl+cx,yt+cy,w,h);};this.setStroke(1);this.setFont('verdana,geneva,helvetica,sans-serif',String.fromCharCode(0x31,0x32,0x70,0x78),Font.PLAIN);this.color='#000000';this.htm='';this.wnd=wnd||window;if(!(jg_ie||jg_dom||jg_ihtm))chkDHTM();if(typeof id !='string'||!id)this.paint=pntDoc;else{this.cnv=document.all?(this.wnd.document.all[id]||null): document.getElementById?(this.wnd.document.getElementById(id)||null): null;this.defhtm=(this.cnv&&this.cnv.innerHTML)?this.cnv.innerHTML : '';this.paint=jg_dom?pntCnvDom : jg_ie?pntCnvIe : jg_ihtm?pntCnvIhtm : pntCnv;};this.setPrintable(false);};function integer_compare(x,y){return(x<y)?-1 :((x>y)*1);}
 function updateMap(murl){var loadObj=document.getElementById("loading");$.ajax({url: murl,dataType: "json",success: function(response){var sessionerror=response.sessionerror;if(sessionerror=='true'){errormsg=localeList['sessionExpired'];window.location.reload();return false;};var rBxL=response.refBoxStr.split(',');minx_geo=parseFloat(response.minx_geo);maxy_geo=parseFloat(response.maxy_geo);xdelta_geo=parseFloat(response.xdelta_geo);ydelta_geo=parseFloat(response.ydelta_geo);var geo_scale=response.geo_scale;var urlPntStr=response.urlPntStr;loadMapImg(response.mapURL);var refreshToc=eval(response.refreshToc);if(refreshToc){var tocurl=PM_XAJAX_LOCATION+'x_toc_update.php?'+SID;updateTocScale(tocurl);};writescale(geo_scale);setSlider(geo_scale);PMap.scale=geo_scale;$("#pmMapRefreshImg").src("images/pixel.gif");setRefBox(rBxL[0],rBxL[1],rBxL[2],rBxL[3]);var vMode=_$("varform").mode.value;var autoidentify='';if(vMode=='nquery'||vMode=='iquery'){if(vMode=='iquery'){autoidentify='&autoidentify=1';};var selurl=PM_XAJAX_LOCATION+'x_select.php?'+SID+'&activegroup='+getSelectLayer()+autoidentify;updateSelectTool(selurl);};if(vMode=='measure'){resetMeasure();};var dg=getLayers();var maxx_geo=xdelta_geo+minx_geo;var miny_geo=maxy_geo-ydelta_geo;var me=minx_geo+','+miny_geo+','+maxx_geo+','+maxy_geo;var confpar=PMap.config.length>0?'&config='+PMap.config : '';var urlPntStrPar=urlPntStr.length>1?'&up='+urlPntStr.replace(/\%5C\%27/g,'%27'): '';var loc=window.location;var port=loc.port>0?':'+loc.port : '';var linkhref=loc.protocol+'/'+'/'+loc.hostname+port+loc.pathname+'?dg='+dg+'&me='+me+'&language='+PMap.gLanguage+confpar+urlPntStrPar;if(_$('current_maplink'))_$('current_maplink').href=linkhref;}});};function updateToc(tocurl){$.ajax({url: tocurl,dataType: "json",success: function(response){var tocHTML=response.tocHTML;setInnerHTML('toc',tocHTML);var tocButtons=response.tocButtons;if(tocButtons.length>0){$('#autoRefreshButton').html(tocButtons);};var tocurl=PM_XAJAX_LOCATION+'x_toc_update.php?'+SID;updateTocScale(tocurl);}});};function updateTocScale(tocurl){$.ajax({url: tocurl,dataType: "json",success: function(response){var legStyle=response.legStyle;var layers=response.layers;if(legStyle=="swap"&&$('#toclegend').css('display')=='block'){swapToLegendView();};for(var l in layers){$('#spxg_'+l).removeClass('unvis').removeClass('vis').addClass(layers[l]);}}});};function showMapLegend(tocurl){$.ajax({url: tocurl,dataType: "json",success: function(response){var tocHTML=response.tocHTML;var legDiv=_$('maplegend');setInnerHTML('maplegend',tocHTML);legDiv.style.visibility='visible';}});};function swapLegend(tocurl){$.ajax({url: tocurl,dataType: "json",success: function(response){var tocHTML=response.tocHTML;$('#toclegend').html(tocHTML);$('#toc').hide();$('#toclegend').show();}});};function updateSelectTool(selurl){$.ajax({url: selurl,dataType: "json",success: function(response){var selStr=response.selStr;$('#mapToolArea').html(selStr);}});};function updateSelLayers(selurl){$.ajax({url: selurl,dataType: "json",success: function(response){var sellayers=response.sellayers;var vMode=_$("varform").mode.value;if(vMode=='nquery'||vMode=='iquery'){var selurl=PM_XAJAX_LOCATION+'x_select.php?'+SID+'&activegroup='+getSelectLayer();updateSelectTool(selurl);}}});};function addPOI(digitizeurl){$.ajax({type: "POST",url: digitizeurl,success: function(response){changeLayersDraw();}});};function getQueryResult(qurl,params){$.ajax({type: "POST",url: qurl,data: params,dataType: "json",success: function(response){var mode=response.mode;var queryResult=response.queryResult;if(mode !='iquery'){if(PMap.infoWin=='window'){openResultwin('info.phtml?'+SID);}else{$('#infoFrame').showv();writeQResult(queryResult,PMap.infoWin);};pmIndicator_hide();}else{showIQueryResults(queryResult);}}});};function exportQueryResults(expurl){$.ajax({url: expurl,success: function(response){}});};function addWMS(url){$.ajax({url: url,success: function(response){pmToc_init();}});};function createSearchItems(url){$.ajax({url: url,dataType: "json",success: function(response){var searchJson=response.searchJson;var action=response.action;var divelem=response.divelem;if(action=='searchitem'){var searchHtml=createSearchInput(searchJson);}else{var searchHtml=json2Select(searchJson,"0");$('#searchoptions').html(searchHtml);}}});};function getSuggest(suggesturl){$.ajax({type: "POST",url: suggesturl,dataType: "json",success: function(response){var searchGet=response.searchGet;var suggestList=response.retvalue;var fldname=response.fldname;pmSuggest.suggestCache[searchGet]=suggestList;writeSuggestList(suggestList,fldname);}});}
 var mouseDrag=false;var maction;var rightMouseButton=false;var downX,downY;var upX,upY;var moveX,moveY;var rBoxMinW=8;var rOffs=13;if(document.all){var zBorder=0;}else{var zBorder=4;};var refmapClick=false;var mapcL,mapcT,mapcL,mapcR;var mapElem;var isIE=(document.all)?true : false;var m_offsX=0;var m_offsY=0;var pmZB=new Object();function startUp(){if(typeof(pmZB)!="undefined"){pmZB.theMapImg=document.getElementById("mapimg");pmZB.theMapImgL=document.getElementById("mapimgLayer");pmZB.zb=document.getElementById("zoombox");};refmapClick=false;if(document.all)document.onkeydown=kp;mapElem=document.getElementById('map');if(mapElem){mapElem.onmousedown=doMouseDown;mapElem.onmouseup=doMouseUp;mapElem.onmousemove=doMouseMove;if(isIE){mapElem.onmousewheel=omw;}else{mapElem.addEventListener('DOMMouseScroll',omw,false);};mapElem.oncontextmenu=disableContextMenu;setCursorMinMax('map');}};function startUpRef(){clearTimeout(PMQuery.iquery_timer);refmapClick=true;refElem=_$('refmap');if(refElem){refElem.onmousedown=doMouseDown;refElem.onmouseup=doMouseUp;refElem.onmousemove=doMouseMove;if(isIE){refElem.onmousewheel=omw;}else{refElem.addEventListener('DOMMouseScroll',omw,false);};setCursorMinMax('refmap');}};function setCursorMinMax(elem){if(elem=='map'){var oMap=$('#map');mapcL=oMap.offset()['left']+1;mapcT=oMap.offset()['top']+1;mapcR=mapcL+mapW;mapcB=mapcT+mapH;var curelem=oMap;}else{var rMap=$('#refmap');mapcL=rMap.offset()['left'];mapcT=rMap.offset()['top'];mapcR=mapcL+refW;mapcB=mapcT+refH;var curelem=rMap;};offsX=curelem.offset()['left']+1;offsY=curelem.offset()['top']+1;};function checkCursorPosition(cX,cY){if(cX>=mapcL&&cX<=mapcR&&cY>=mapcT&&cY<=mapcB){return true;}else{return false;}};function getDownXY(e){if(document.all){eX=event.clientX;eY=event.clientY;}else{eX=e.pageX;eY=e.pageY;};downX=eX-offsX;downY=eY-offsY;mapElem.onmouseup=doMouseUp;mapElem.onmousemove=doMouseMove;mapElem.ondblclick=doMouseDblClick;return false;};function getUpXY(e){if(document.all){eX=event.clientX;eY=event.clientY;}else{eX=e.pageX;eY=e.pageY;};if(!refmapClick){upX=Math.min(eX-offsX,mapW);upY=Math.min(eY-offsY,mapH);}else{upX=eX-offsX;upY=eY-offsY;};return false;};function getMoveXY(e){if(document.all){moveX=event.clientX;moveY=event.clientY;}else{moveX=e.pageX;moveY=e.pageY;};moveX=moveX-offsX;moveY=moveY-offsY;};function doMouseDown(e){e=(e)?e:((event)?event:null);try{if(enableRightMousePan){if(e.button==2){rightMouseButton=true;setCursor(true,false);}else{rightMouseButton=false;}}}catch(e){};if(document.all)document.onkeydown=kp;document.onkeypress=kp;mouseDrag=true;getDownXY(e);if(refmapClick){if(downX<1||downY<1||downX>refW||downY>refH){return false;}else{moveRefBox('shift');}};return false;};function doMouseUp(e){e=(e)?e:((event)?event:null);mouseDrag=false;getUpXY(e);var varform=_$("varform");if(!refmapClick){maction=varform.maction.value;if(rightMouseButton){maction='pan';};if(maction=='measure'){measureDrawSymbols(e,upX,upY,0);}else if(maction=='pan'){var diffX=upX-downX;var diffY=upY-downY;if(diffX==0&&diffY==0){var newX=upX;var newY=upY;}else{var newX=(mapW/2)-diffX;var newY=(mapH/2)-diffY;};zoombox_apply(newX,newY,newX,newY);maction=varform.maction.value;rightMouseButton=false;setCursor(false,false);}else if(maction=='click'){zoombox_apply(downX,downY,downX,downY);}else if(maction=='move'){return false;}else{zoombox_apply(Math.min(downX,upX),Math.min(downY,upY),Math.max(downX,upX),Math.max(downY,upY));}}else{if(upX<1||upY<1||upX>refW||upY>refH){alert(upX+' ref out');return false;}else{zoombox_apply(upX,upY,upX,upY);}};return false;};function doMouseMove(e){e=(e)?e:((event)?event:null);getMoveXY(e);if(!refmapClick){var varform=_$("varform");if(varform){maction=varform.maction.value;};if(rightMouseButton){maction='pan';};displayCoordinates();switch(maction){case 'box': if(mouseDrag==true){startZoomBox(e,moveX,moveY);}else if(varform.mode.value=='nquery'){try{if(combinedSelectIquery){clearTimeout(PMQuery.iquery_timer);PMQuery.iquery_timer=setTimeout("applyIquery("+moveX+","+moveY+")",300);}}catch(e){return false;}};break;case 'click': hideObj(_$('zoombox'));break;case 'pan': hideObj(_$('zoombox'));startPan(e,moveX,moveY);break;case 'measure': case 'digitize': showObj(_$('measureLayer'));showObj(_$('measureLayerTmp'));redrawAll(moveX,moveY);break;case 'move': if(varform.mode.value=='iquery'){if(PMQuery.follow){PMQuery.timer_c=0;clearTimeout(PMQuery.timer_t);clearTimeout(PMQuery.iquery_timer);hideObj(_$('iqueryLayer'));timedCount(moveX,moveY);}else{clearTimeout(PMQuery.iquery_timer);PMQuery.iquery_timer=setTimeout("applyIquery("+moveX+","+moveY+")",300);}};break;default: try{eval(maction+'_mmove(e,moveX,moveY)');}catch(e){};break;}}else{hideObj(_$('zoombox'));if(mouseDrag){moveRefBox('move');}};return false;};function doMouseDblClick(e){getUpXY(e);var varform=_$("varform");maction=varform.maction.value;if(maction=='measure'||maction=='digitize'){measureDrawSymbols(e,upX,upY,1);}else{try{eval(maction+'_mdblclick()');return false;}catch(e){}}};function startZoomBox(e,moveX,moveY){if(mouseDrag==true){if(checkCursorPosition(moveX+offsX,moveY+offsY)){var boxL=Math.min(moveX,downX);var boxT=Math.min(moveY,downY);var boxW=Math.abs(moveX-downX);var boxH=Math.abs(moveY-downY);pmZB.zb.style.visibility="visible";pmZB.zb.style.left=boxL+"px";pmZB.zb.style.top=boxT+"px";pmZB.zb.style.width=boxW+"px";pmZB.zb.style.height=boxH+"px";}};return false;};function startPan(e,moveX,moveY){if(mouseDrag==true){if(checkCursorPosition(moveX+offsX,moveY+offsY)){var mapL=moveX-downX;var mapT=moveY-downY;var clipT=0;var clipR=mapW;var clipB=mapH;var clipL=0;pmZB.theMapImgL.style.top=mapT+"px";pmZB.theMapImgL.style.left=mapL+"px";}};return false;};function setRefBox(boxL,boxT,boxW,boxH){var rBox=$("#refbox");var sBox=$("#sliderbox");var rCross=$("#refcross");rBox.left(boxL+"px");rBox.top(boxT+"px");rBox.width(boxW+"px");rBox.height(boxH+"px");if(boxW<rBoxMinW){rBox.hidev();rCross.showv();setRefCross(rCross,boxL,boxT,boxW,boxH);}else{rCross.hidev();rBox.showv();};sBox.hidev();};function moveRefBox(moveAction){var rBox=$("#refbox");var rCross=$("#refcross");var boxL=rBox.ileft();var boxT=rBox.itop();var boxW=rBox.iwidth();var boxH=rBox.iheight();if(moveAction=='shift'){var newX=downX;var newY=downY;}else{var newX=moveX;var newY=moveY;};boxLnew=newX-(boxW/2)-1;boxTnew=newY-(boxH/2)-1;if(boxLnew<0||boxTnew<0||(boxLnew+boxW)>refW||(boxTnew+boxH)>refH){return false;}else{rBox.left(boxLnew+"px");rBox.top(boxTnew+"px");window.status=(boxLnew+boxW+'-'+refW);if(boxW<rBoxMinW){setRefCross(rCross,boxLnew,boxTnew,boxW,boxH);}}};function setRefCross(rCross,boxL,boxT,boxW,boxH){boxcX=parseInt(boxL)+parseInt((boxW/2));boxcY=parseInt(boxT)+parseInt((boxH/2));rCross.left(Math.round((boxcX-rOffs))+"px");rCross.top(Math.round((boxcY-rOffs))+"px");};function resizeMap(sizeFactor){var theMapImg=$('#mapImg');var theMapLay=$('#mapimgLayer');var oldW=mapW;var oldH=mapH;var newW=oldW*sizeFactor;var newH=oldH*sizeFactor;var newLeft=(oldW-newW)/2;var newTop=(oldH-newH)/2;theMapImg.width(newW+"px");theMapImg.height(newH+"px");theMapLay.left(newLeft+"px");theMapLay.top(newTop+"px");if(sizeFactor>1){var diffW=parseInt((newW-oldW)/2);var diffH=parseInt((newH-oldH)/2);clipT=diffH;clipR=diffW+oldW;clipB=diffH+oldH;clipL=diffW;var clipRect='rect('+clipT+'px '+clipR+'px '+clipB+'px '+clipL+'px)';theMapLay.css('clip',clipRect);theMapLay.width(newW+"px");theMapLay.height(newH+"px");}};function resizeRefBox(sizeFactor){var refZoomBox=$('#refbox');var refSliderBox=$('#refsliderbox');refSliderBox.showv();if(refZoomBox.ileft()>0){var refBoxBorderW=1;var oldRefW=refZoomBox.iwidth();var oldRefH=refZoomBox.iheight();var oldRefLeft=refZoomBox.ileft();var oldRefTop=refZoomBox.itop();var newRefW=Math.round(oldRefW/sizeFactor);var newRefH=Math.round(oldRefH/sizeFactor);var newRefLeft=parseInt(oldRefLeft+((oldRefW-newRefW)/2)+refBoxBorderW);var newRefTop=parseInt(oldRefTop+((oldRefH-newRefH)/2)+refBoxBorderW);refSliderBox.left(newRefLeft+"px");refSliderBox.top(newRefTop+"px");refSliderBox.width(newRefW+"px");refSliderBox.height(newRefH+"px");}};function kp(e){try{e=(e)?e :((event)?event : null);}catch(e){};if(e){var charCode=(e.charCode)?e.charCode:e.keyCode;var b=true;var nStep=16;switch(charCode){case 63232: case 38: arrowpan('n');break;case 63233: case 40: arrowpan('s');break;case 63234: case 37: arrowpan('w');break;case 63235: case 39: arrowpan('e');break;case 63276: case 33: gofwd();break;case 63277: case 34: goback();break;case 63273: case 36: zoomfullext();break;case 63275: case 35: break;case 43: zoompoint(2,'');break;case 45: zoompoint(-2,'');break;case 46: delLastPoint();break;case 27: if(_$("varform").maction.value=='measure'){resetMeasure();};break;default: b=false;}}};function omw(e){e=(e)?e:((event)?event:null);if(e){try{var imgxy=(refmapClick?'' :(wheelZoomPointerPosition?moveX+"+"+moveY : ''));var wInv=wheelZoomGoogleStyle?-1 : 1;}catch(e){var imgxy='';var wInv=1;};var wD=(e.wheelDelta?e.wheelDelta : e.detail*-1)*wInv;clearTimeout(PMap.resize_timer);if(wD<0){PMap.resize_timer=setTimeout("zoompoint(2,'"+imgxy+"')",300);return false;}else if(wD>0){PMap.resize_timer=setTimeout("zoompoint(-2,'"+imgxy+"')",300);return false;}}};function disableContextMenu(e){e=(e)?e:((event)?event:null);return false;};function getGeoCoords(mouseX,mouseY,convert2latlon){var x_geo=minx_geo+((mouseX/mapW)*xdelta_geo);var y_geo=maxy_geo-((mouseY/mapH)*ydelta_geo);if(convert2latlon){var mpoint=laea2latlon(x_geo,y_geo);}else{var mpoint=new Object();mpoint.x=x_geo;mpoint.y=y_geo;};return mpoint;};
 function displayCoordinates(){var mpoint=getGeoCoords(moveX,moveY,false);var rfactor=0;var px=isNaN(mpoint.x)?'' : roundN(mpoint.x,4);var py=isNaN(mpoint.y)?'' : roundN(mpoint.y,4);$('#xcoord').html('Longitud: '+px);$('#ycoord').html('Latitud: '+py);};function laea2latlon(X,Y){var a=6378137;var f=1/298.257222101;var e2=(2*f)-(f*f);var e=Math.sqrt(e2);var ph0=52/180*Math.PI;var la0=10/180*Math.PI;var X0=4321000.0;var Y0=3210000.0;var q0=(1-e2)*((Math.sin(ph0)/(1-(e2*Math.pow(Math.sin(ph0),2))))-((1/(2*e))*Math.log((1-(e*Math.sin(ph0)))/(1+(e*Math.sin(ph0))))));var qp=(1-e2)*((1/(1-e2))-((1/(2*e))*Math.log((1-e)/(1+e))));var beta0=Math.asin(q0/qp);var Rq=a*Math.sqrt(qp/2);var D=(a*Math.cos(ph0))/(Math.sqrt(1-(e2*Math.pow(Math.sin(ph0),2)))*(Rq*Math.cos(beta0)));var p=Math.sqrt(Math.pow((X-X0)/D,2)+Math.pow(D*(Y-Y0),2));var C=2*Math.asin(p/(2*Rq));var beta_=Math.asin((Math.cos(C)*Math.sin(beta0))+(((D*(Y-Y0))*Math.sin(C)*Math.cos(beta0))/p));var lat1=((e2/3)+((31*Math.pow(e2,2))/180)+((517*Math.pow(e2,3))/5040))*Math.sin(2*beta_);var lat2=(((23*Math.pow(e2,2))/360)+((251*Math.pow(e2,3))/3780))*Math.sin(4*beta_);var lat3=((761*Math.pow(e2,3))/45360)*Math.sin(6*beta_);var lat=(beta_+lat1+lat2+lat3)*(180/Math.PI);var lon=(la0+Math.atan(((X-X0)*Math.sin(C))/((D*p*Math.cos(beta0)*Math.cos(C))-(D*D*(Y-Y0)*Math.sin(beta0)*Math.sin(C)))))*(180/Math.PI);var mpoint=new Object();mpoint.x=lon;mpoint.y=lat;return mpoint;}
 var myslider;var slScale;function createZSlider(sliderElemId){if(_$(sliderElemId)){myslider=new slider(sliderElemId,140,14,'#666666',1,'#000000',2,'#666666',14,20,'#999999',1,'<img src="images/slider_updown.gif" style="display:block;margin:auto;"/>',false,'sliderMove','sliderStop',true);}};function sliderMove(sliderPosition){currScale=PMap.scale;if(zsliderVertical)sliderPosition=1-sliderPosition;slScale=sliderx2Scale(sliderPosition);var strlenSlScale=parseInt(slScale).toString().length;var redFact=Math.pow(10,strlenSlScale-2);slScale=Math.round(slScale/redFact)*redFact;_$("scaleform").scale.value=slScale;var scaleRatio=currScale/slScale;resizeMap(scaleRatio);resizeRefBox(scaleRatio);};function sliderx2Scale(x){var sliderScale=(1-x)*PMap.s1+(x*PMap.s2)-(x*(1-x)*PMap.s1);return sliderScale;};function sliderStop(){zoom2scale(slScale);mouseIsPressed=false;return false;};function getSliderPosition(curscale){var s1=PMap.s1;var s2=PMap.s2;var eqPart=Math.sqrt((s2*s2)+(4*s1*curscale)-(4*s1*s2));var pos=((2*s1)-s2+eqPart)/(2*s1);if(pos<0||pos>1){pos=((2*s1)-s2-eqPart)/(2*s1);};if(pos>1||isNaN(pos))pos=1;if(zsliderVertical)pos=1-pos;return pos;};var mouseIsPressed=false;var MWJ_slider_controls=0;function sliderMousePos(e){if(!e){e=window.event;};if(!e||(typeof(e.pageX)!='number'&&typeof(e.clientX)!='number')){return [0,0];};if(typeof(e.pageX)=='number'){var xcoord=e.pageX;var ycoord=e.pageY;}else{var xcoord=e.clientX;var ycoord=e.clientY;if(!((window.navigator.userAgent.indexOf('Opera')+1)||(window.ScriptEngine&&ScriptEngine().indexOf('InScript')+1)||window.navigator.vendor=='KDE')){if(document.documentElement&&(document.documentElement.scrollTop||document.documentElement.scrollLeft)){xcoord+=document.documentElement.scrollLeft;ycoord+=document.documentElement.scrollTop;}else if(document.body&&(document.body.scrollTop||document.body.scrollLeft)){xcoord+=document.body.scrollLeft;ycoord+=document.body.scrollTop;}}};return [xcoord,ycoord];};function slideIsDown(e){window.msStartCoord=sliderMousePos(e);window.lyStartCoord=this.style?[parseInt(this.style.left),parseInt(this.style.top)]:[parseInt(this.left),parseInt(this.top)];if(document.captureEvents&&Event.MOUSEMOVE){document.captureEvents(Event.MOUSEMOVE);document.captureEvents(Event.MOUSEUP);};window.storeMOUSEMOVE=document.onmousemove;window.storeMOUSEUP=document.onmouseup;window.storeLayer=this;mouseIsPressed=true;document.onmousemove=slideIsMove;document.onmouseup=slideIsMove;return false;};function slideIsMove(e){if(mouseIsPressed){var msMvCo=sliderMousePos(e);if(!e){e=window.event?window.event :(new Object());};var theLayer=window.storeLayer.style?window.storeLayer.style : window.storeLayer;var oPix=document.childNodes?'px' : 0;if(window.storeLayer.hor){var theNewPos=window.lyStartCoord[0]+(msMvCo[0]-window.msStartCoord[0]);if(theNewPos<0){theNewPos=0;};if(theNewPos>window.storeLayer.maxLength){theNewPos=window.storeLayer.maxLength;};theLayer.left=theNewPos+oPix;}else{var theNewPos=window.lyStartCoord[1]+(msMvCo[1]-window.msStartCoord[1]);if(theNewPos<0){theNewPos=0;};if(theNewPos>window.storeLayer.maxLength){theNewPos=window.storeLayer.maxLength;};theLayer.top=theNewPos+oPix;};if(e.type&&e.type.toLowerCase()=='mousemove'){if(window.storeLayer.moveFunc){window.storeLayer.moveFunc(theNewPos/window.storeLayer.maxLength);}}else{document.onmousemove=storeMOUSEMOVE;document.onmouseup=window.storeMOUSEUP;if(window.storeLayer.stopFunc){window.storeLayer.stopFunc(theNewPos/window.storeLayer.maxLength);}}}};function setSliderPosition(oPortion){if(isNaN(oPortion)||oPortion<0){oPortion=0;};if(oPortion>1){oPortion=1;};var theDiv=document.getElementById(this.id);if(!theDiv){return false};if(theDiv.style){theDiv=theDiv.style;};oPortion=Math.round(oPortion*this.maxLength);var oPix=document.childNodes?'px' : 0;if(this.align){theDiv.left=oPortion+oPix;}else{theDiv.top=oPortion+oPix;}};function slider(sliderElemId,oThght,oTwdth,oTcol,oTBthk,oTBcol,oTRthk,oTRcol,oBhght,oBwdth,oBcol,oBthk,oBtxt,oAlgn,oMf,oSf,oCrs){var sliderStr=('<div style="position:relative;left:0px;top:0px;height:'+(oThght+(2*oTBthk))+'px;width:'+(oTwdth+(2*oTBthk))+'px;background-color:'+oTBcol+';font-size:0px;">'+'<div style="position:relative;left:'+oTBthk+'px;top:'+oTBthk+'px;height:'+oThght+'px;width:'+oTwdth+'px;background-color:'+oTcol+';font-size:0px;">'+'<div style="position:absolute;left:'+(oAlgn?0:Math.floor((oTwdth-oTRthk)/2))+'px;top:'+(oAlgn?Math.floor((oThght-oTRthk)/2):0)+'px;height:'+(oAlgn?oTRthk:oThght)+'px;width:'+(oAlgn?oTwdth:oTRthk)+'px;background-color:'+oTRcol+';font-size:0px;"><\/div>'+'<div style="position:absolute;left:'+(oAlgn?0:Math.floor((oTwdth-(oBwdth+(2*oBthk)))/2))+'px;top:'+(oAlgn?Math.floor((oThght-(oBhght+(2*oBthk)))/2):0)+'px;height:'+(oBhght+(2*oBthk))+'px;width:'+(oBwdth+(2*oBthk))+'px;font-size:0px;" ondragstart="return false;" onselectstart="return false;" onmouseover="this.hor='+oAlgn+';this.maxLength='+((oAlgn?oTwdth:oThght)-((oAlgn?oBwdth:oBhght)+(2*oBthk)))+';this.moveFunc='+oMf+';this.stopFunc='+oSf+';this.onmousedown=slideIsDown;" id="MWJ_slider_controls'+MWJ_slider_controls+'">'+'<div style="border-top:'+oBthk+'px solid #ffffff;border-left:'+oBthk+'px solid #ffffff;border-right:'+oBthk+'px solid #000000;border-bottom:'+oBthk+'px solid #000000;">'+'<div style="height:'+oBhght+'px;width:'+oBwdth+'px;font-size:0px;background-color:'+oBcol+';cursor:'+(oCrs?'pointer;cursor:move':'default')+';">'+'<span style="width:100%;text-align:center;">'+oBtxt+'<\/span><\/div><\/div><\/div><\/div><\/div>');document.getElementById(sliderElemId).innerHTML=sliderStr;this.id='MWJ_slider_controls'+MWJ_slider_controls;this.maxLength=(oAlgn?oTwdth:oThght)-((oAlgn?oBwdth:oBhght)+(2*oBthk));this.align=oAlgn;this.setPosition=setSliderPosition;MWJ_slider_controls++;}
 function openCreditos(){createDnRDlg({w:500, h:300, l:100, t:50}, {resizeable:true, newsize:true}, 'pmDlgContainer', localeList['Creditos'], 'Gazetero/php/Creditos.php?'+SID);};
